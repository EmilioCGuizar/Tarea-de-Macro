---
title: "Mercados Laborales: Tarea 1 (Equipo 4)"
author: 
  - José Emilio Cendejas Guízar^[El Colegio de México, jcendejas@colmex.mx]
  - Héctor González Magaña^[El Colegio de México, hgonzalez@colmex.mx]
  - Lino Antonio Mendoza Millán^[El Colegio de México, lamendoza@colmex.mx]
date: \today
output: 
  pdf_document:
    toc: true
    toc_depth: 3
  tables: true
toc-title: Contenido
urlcolor: blue
header-includes: 
  - \usepackage[nottoc]{tocbibind}
  - \renewcommand{\listfigurename}{Lista de figuras}
  - \renewcommand{\listtablename}{Lista de tablas}
  - \usepackage[utf8]{inputenc}
  - \usepackage[spanish]{babel}
  - \usepackage{graphicx}
  - \usepackage{float}
---


\newpage

\listoffigures

\listoftables

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.align="center", fig.pos = "H", fig.width = 7, fig.height = 3)
```

\newpage

# Preguntas teóricas

## Ejercicio 11.2, Romer (5ta Edicion)
**1. Resuelva los ejercicios 11.2 y 11.9 (5a Ed.). Realice estos con ayuda de su 
laboratorista y entregue las soluciones a máquina, utilizando LaTeX.**

\begin{enumerate}
\item[] \textbf{11.2} Efficiency wages and bargaining. (Garino and Martin, 2000). Summers (1988), p.386) states, "In an effiency wage environment, firms that are forced to pay their workers preminum wages suffer only second-order losses. In almost any plausible bargaining framework, this makes it easier for workers to extract concessions." This problem asks you to investigate this claim.
\end{enumerate}
Consider a firm with profits given by $\pi=[\frac{(eL)^{\alpha}}{\alpha}]-wL$, $0<\alpha<1$, and a union with objective function $U=(w-x)L$, where x is an index of its workers'outside opportunities. Assume that the firm and the union bargain over the wage, and that the firm then chooses L taking w as given.

\begin{enumerate}
\item[a)] Suppose that e is fixed at 1, so that the effiency-wage considerations are absent.
\end{enumerate}

\begin{enumerate}
\item[a.1] What value of L does the firm choose, given w$?$ what is the resulting level of profits$?$.
\end{enumerate}
  
Si $e=1$ y w está dado, el problema de la firma es elegir L para maximizar sus beneficios:
$$ \max\limits_{L}\pi=  \frac{L^{\alpha}}{\alpha}-wL  $$
CPO:
$$ \frac{\partial \pi}{\partial L}: \alpha \frac{L^{\alpha -1}}{\alpha}-w =0  $$
$$ \Rightarrow L^{\alpha -1} = w $$
$$ \Rightarrow L^*=w^{\frac{1}{\alpha -1}}$$
Sustituimos L* en $\pi$ obtenemos $\pi^*$, donde la empresa maximiza el beneficio dado $w$

$$ \pi^*= \frac{{\left(w^{\frac{1}{\alpha-1}} \right)}^{\alpha}}{\alpha} - w \left (w^{\frac{1}{\alpha-1}} \right )= \frac{w^{\frac{\alpha}{\alpha-1}}-\alpha w^{\frac{\alpha}{\alpha-1}}}{\alpha}$$

$$  \Rightarrow \pi^*= \left (\frac{1- \alpha}{\alpha} \right )w^{\frac{1}{\alpha-1}} $$

\begin{enumerate}
\item[a.2] Suppose that the firm and the union choose w to maximize ${U}^{\gamma}{\pi}^{1- \gamma}$ , where $0 <{\gamma} <  {\alpha }$ indexes the union’s power in the bargaining. What level of w do they choose$?$
\end{enumerate}

$$\max\limits_{w}{U}^{\gamma}{\pi^*}^{1- \gamma} $$
Sustiuimos el nivel de $L^*$ en la función objetivo del sindicato, $(w-x)L^*$:
$$\max\limits_{w} [(w-x)L^*]^{\gamma} \left[ \left (\frac{1- \alpha}{\alpha} \right)w^{\frac{1}{\alpha-1}} \right]^{1- \gamma}$$
Tomamos el logaritmo natural de ${U}^{\gamma}{\pi}^{1- \gamma}$ y derivamos con respecto a este, con la finalidad de simplificar los cálculos, tenemos entonces:

$$\max\limits_{w} \gamma \left[\ln(w-x)+\frac{1}{\alpha -1} \ln(w) \right]
+ (1- \gamma)\left[ \ln \left( \frac{1- \alpha}{\alpha} \right) + \left (\frac{\alpha}{\alpha-1} \right )ln(w) \right]
$$
CPO:

$$
\frac{\partial {U}^{\gamma}{\pi}^{1- \gamma}}{\partial w}: \frac{\gamma}{w-x} + \frac{ \gamma}{w( \alpha-1)}+ \frac{ \alpha(1- \gamma)}{w( \alpha -1)}=0
$$
$$
\Rightarrow \frac{ \gamma}{w-x}=- \left [ \frac{ \gamma + \alpha - \alpha \gamma}{w( \alpha-1)}\right ]=- \left[ \frac{ \alpha + \gamma (1- \alpha)}{w( \alpha-1)} \right]
$$
$$
\Rightarrow \gamma = - \left [ \frac{ \alpha+ \gamma(1- \alpha)}{w( \alpha-1)} \right](w-x)=\frac{- \alpha -\gamma (1- \alpha)}{ \alpha -1}+ \frac{x( \alpha + \gamma (1- \alpha))}{w(\alpha -1)}
$$
$$
\Rightarrow \frac{x( \alpha + \gamma (1- \alpha))}{w(\alpha -1)} = \gamma +\frac{ \alpha +\gamma (1- \alpha)}{ \alpha -1}= \frac{\alpha}{\alpha -1}
$$
Por tanto, el salario escogido durante el proceso de negociación es:
$$
\Rightarrow w^*=\frac{x( \alpha + \gamma (1- \alpha))}{\alpha}
$$
\begin{enumerate}
\item[b)]Suppose that e is given by equation (11.12) in the text: $e=[\frac{(w-x}{x}]^{\beta}$ for  $w>x$ where $0<\beta <1$.
\end{enumerate}
\begin{enumerate}
\item[b.1.] What value of L does the firm choose, given w$?$, What is the resulting level of profits$?$
\end{enumerate}
Ahora vamos a encontrar $L^*$ que maximiza $\pi$ en presencia de una ecuación de esfuerzo.
$$
\max\limits_{L}\pi= \frac{ \left ( \left ( \frac{w-x}{x} \right )^ \beta L \right )^{\alpha}}{\alpha}-wL
$$
CPO:
$$
\frac{\partial \pi}{\partial L}: \frac{ \alpha \left ( \left ( \frac{w-x}{x} \right )^ \beta L \right )^{\alpha-1}}{\alpha}-w=0
$$
$$
\Rightarrow w= \left (  \frac{w-x}{x} \right )^ {\alpha \beta} L^{\alpha-1}
$$
$$
\Rightarrow L^{\alpha -1}=w \left( \frac{x}{w-x} \right )^{\alpha \beta}
$$
$$
\Rightarrow L^*= \left ( w \left( \frac{x}{w-x} \right )^{\alpha \beta} \right)^{\frac{1}{\alpha -1}}= \left(\frac{w-x}{x} \right)^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{1}{\alpha -1}}
$$
Sustituimos L* en $\pi$, así como hicimos en pasos anteriors, y obtenemos $\pi^*$, donde la empresa maximiza el beneficio dado $w$
$$
\pi^*= \frac{ \left[ \left (\frac{w-x}{x} \right )^\beta \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{1}{\alpha -1}} \right ]^\alpha}{\alpha}-w \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{1}{\alpha -1}}
$$
De tal modo que este es el beneficio óptimo al nivel dado de salarios en presencia de una ecuación de esfuerzo.
$$
\Rightarrow \pi^*= \frac{ \left[  \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{\alpha}{\alpha -1}} \right ]}{\alpha}- \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{\alpha}{\alpha -1}}=\left( \frac{1- \alpha}{\alpha} \right ) w^{\frac{\alpha}{\alpha -1}} \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}} 
$$
 \begin{enumerate}
\item[b.2.] Suppose that the firm and the union choose w to maximize ${U}^{\gamma}{\pi}^{1- \gamma}$, $0<{\gamma} < {\alpha}$ What level of w do they choose? (Hint: For the case of $\beta =0$, your answer should simplify to your answer in part [a][ii].)
\end{enumerate}
Vamos a sustituir el nivel de $L^* $obtenido en el inciso anterior en la función objetivo del sindicato, $(w-x)L^*$: 
$$\max\limits_{w}{U}^{\gamma}{\pi^*}^{1- \gamma} $$
$$
\max\limits_{w} \left[ (w-x) \left (\frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{-1}{1- \alpha }}\right ]^{\gamma} \left[ \left( \frac{1- \alpha}{\alpha} \right ) w^{\frac{- \alpha}{1- \alpha}} \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}} \right]^{1- \gamma}
$$

Aplicamos logaritmo natural y derivando como en el inciso anterior, obtenemos:

$$
\max\limits_{w} \gamma \left[ \ln(w-x) + \left (\frac{\alpha \beta}{1- \alpha} \right ) \ln \left (\frac{w-x}{x} \right )- \left( \frac{1}{1- \alpha} \right ) w \right ]+ (1- \gamma) \left[\ln \left( \frac{1- \alpha}{\alpha} \right ) - \left (\frac{\alpha}{1- \alpha } \right) \ln( w) + \left (\frac{\alpha \beta}{1- \alpha} \right ) \ln \left( \frac{w-x}{x} \right ) \right]
$$

CPO:
$$
\frac{\partial \ln U^{\gamma}{\pi^*}^{1- \gamma}}{\partial w}: \gamma \left[ \left(\frac{1- \alpha + \alpha \beta}{1- \alpha}\right ) \left (\frac{1}{w-x} \right )- \left( \frac{1}{1- \alpha}\right ) \left( \frac{1}{w}\right) \right]+(1- \gamma) \left[ - \left ( \frac{\alpha}{1- \alpha} \right ) \left( \frac{1}{w} \right ) + \left( \frac{ \alpha \beta}{1- \alpha} \right ) \left (\frac{1}{w-x} \right ) \right]=0
$$
$$
\Rightarrow \left( \frac{1}{w-x}\right) \left( \frac {\gamma -\alpha \gamma + \alpha \beta}{1- \alpha}\right)=\left ( \frac{1}{w} \right ) \left(\frac{- \gamma - \alpha +\alpha \gamma}{1- \alpha} \right)
$$
$$
\Rightarrow w(\gamma -\alpha \gamma + \alpha \beta)=(w-x)(- \gamma - \alpha +\alpha \gamma)
$$
$$
\Rightarrow \alpha \beta w - \alpha w= \alpha \gamma x - \gamma x - \alpha x
$$

Así encontramos el salario óptimo fijado por la empresa y el sindicato cuando existe una ecuación de esfuerzo.
$$
\Rightarrow w^*= \frac{x( \alpha \gamma -\gamma - \alpha )}{\alpha \beta- \alpha}=\frac{x( \alpha + \gamma (1- \alpha))}{\alpha (1- \beta)}
$$

Cuando evaluamos $w^*$ en $\beta =0$ obtenemos:
$$
 w^* \rvert_{\beta=0}=\frac{x( \alpha + \gamma (1- \alpha))}{\alpha (1- 0)}=\frac{x( \alpha + \gamma (1- \alpha))}{\alpha}
$$
Lo cual es igual al resultado obtenido en la segunda parte del inciso a).

 \begin{enumerate}
\item[b.3.]Is the proportional impact of workers’ bargaining power on wages greater with efficiency wages than without, as Summers implies? Is it greater when efficiency-wage effects, $\beta$, are greater?
\end{enumerate}
\textbf{Solucion}
Para comprobar en que caso tiene más poder de negociación el sindicato vamos a utilizar los resultados del salario optimo $w^*$ que se encuentra la parte ii de los incisos a) y b), en b hay salarios de eficiencia.
Donde el subíndice s representa la ausencia de ecuación de esfuerzo y $\beta$ para cuando si hay ecuación de esfuerzo en los salarios.
$$
w^*_s= \frac{x( \alpha + \gamma (1- \alpha))}{\alpha} \quad\textrm{VS}\quad w^*_\beta =\frac{x( \alpha + \gamma (1- \alpha))}{\alpha (1- \beta)}
$$
Podemos notar fácilmente que el numerador de ambos salarios óptimos es igual por lo que lo podemos eliminar para la comparación.
$$
w^*_s= \frac{1}{\alpha} \quad\text{VS}\quad w^*_\beta =\frac{1}{\alpha (1- \beta)}
$$
Si recordamos $0< \beta <1$ es evidente que $\alpha (1- \beta )< \alpha$ por lo cual tendremos que:
$$
w_s^*<w_ \beta ^*
$$

Y esto quiere decir que en presencia de salarios de eficiencia el sindicato tiene la posibilidad de negociar un salario óptimo más alto que cuando no existen salarios de eficiencia (una ecuación de esfuerzo).
Ahora pasamos a analizar que sucede a cuando $\beta$ aumenta.

$$
\frac{ \partial w_ \beta ^*}{ \partial \beta}=x( \alpha + \gamma (1- \alpha)) \left [ \frac{\alpha}{(\alpha(1- \beta))^2} \right ]
$$

Claramente podemos ver que entre mayor sea $\beta$ menor sera el denominador lo cual nos entregará un salario más alto; es decir, a mayor $\beta$ será mayor el poder de negociación del sindicato.

\clearpage

## Ejercicio 11.9, Romer (5ta Edicion)
  
# Ejercicios prácticos

```{r}
pacman::p_load(tidyverse,
               ggthemes,
               haven, readxl,
               kableExtra,
               cowplot, ggplot2, scales, viridis, latticeExtra,
               knitr, tinytex, reshape, lubridate, scales, reshape2)
```

## Ejercicio 2
\begin{enumerate}
\item[] \textbf{2. Estudie el mercado laboral en México siguiendo estos pasos:}
\end{enumerate}
\begin{enumerate}
\item[a.] Obtenga del INEGI una serie anual de los salarios (en términos reales) en México, 
  calcule la serie de su tasa de cambio anual, calcule la volatilidad de dicha serie. (Serie 1)
\end{enumerate}

Cambio porcentual y Volatilidad de Serie 1

```{r}
salarios <- read.csv(file = "Salarios.csv", sep = ",")

salarios <- salarios[,-c(3,4)]

View(salarios)

sal08 <- salarios[2:13,-1]
sal08 <- mean(sal08)
sal09 <- salarios[15:26,-1]
sal09 <- mean(sal09)
sal10 <- salarios[28:39,-1]
sal10 <- mean(sal10)
sal11 <- salarios[41:52,-1]
sal11 <- mean(sal11)
sal12 <- salarios[54:65,-1]
sal12 <- mean(sal12)
sal13 <- salarios[67:78,-1]
sal13 <- mean(sal13)
sal14 <- salarios[80:91,-1]
sal14 <- mean(sal14)
sal15 <- salarios[93:104,-1]
sal15 <- mean(sal15)
sal16 <- salarios[106:117,-1]
sal16 <- mean(sal16)
sal17 <- salarios[119:130,-1]
sal17 <- mean(sal17)
sal18 <- salarios[132:143,-1]
sal18 <- mean(sal18)
sal19 <- salarios[145:156,-1]
sal19 <- mean(sal19)
sal20 <- salarios[158:169,-1]
sal20 <- mean(sal20)
sal21 <- salarios[171:178,-1]
sal21 <- mean(sal21)


sal_anual_real <- c(sal08, sal09, sal10, sal11, sal12, sal13, sal14, sal15, sal16, sal17,
           sal18, sal19, sal20, sal21)

year <- c(2008:2021)

salr <- data.frame(year, sal_anual_real)

salr <- salr %>% mutate(Serie_1 = (sal_anual_real/lag(sal_anual_real)-1)*100)

options(knitr.kable.NA = "-")

knitr::kable(
  salr, booktabs = TRUE, format = 'latex', col.names = c("Año", "Remuneración Media Real (Índice)","Variación %"),
  caption = "Variación Porcentual de los Salarios Reales (2008 - 2021)"
)%>%
  kable_styling(latex_options = "hold_position")
```
```{r eval=TRUE, echo=FALSE}
#Volatilidad
Serie_1 <- salr$Serie_1
vol_s1 <- sd(Serie_1, na.rm = T)
```
La volatilidad de esta tasa de crecimiento, medido por la desviación estándar es de `r vol_s1`
\clearpage

  + Obtenga del INEGI una serie anual del empleo total en México, calcule la 
  serie de su tasa de cambio anual, calcule la volatilidad de dicha serie. (Serie 2)
  
Cambio Porcentual y Volatilidad de Serie 2

```{r} 
# Cambio Porcentual

empleo <- read_excel("Empleo.xls",
                     sheet = 1) 

empleo$Periodos <- year(parse_date_time(empleo$Periodos, orders = "%Y/%q"))

empleo <- empleo %>% group_by(Periodos) %>% summarise(`PEA Ocupada`, PEA_Ocup_anualizado = mean(`PEA Ocupada`, na.rm=T), .groups = 'drop')

empleo <- empleo[!duplicated(empleo[c('PEA_Ocup_anualizado')]),]

empleo <- empleo %>% mutate(Serie_2 = (PEA_Ocup_anualizado/lag(PEA_Ocup_anualizado)-1)*100) 

empleo <- empleo[,c(1,3,4)]

empleo <- na.omit(empleo)

knitr::kable(
  empleo, booktabs = TRUE, format = 'latex', col.names = c("Año", "Población Ocupada","Variación %"),
  caption = "Variación Porcentual de la Población Ocupada (2006 - 2021)", longtable = F
)%>%
  kable_styling(latex_options = "hold_position")
```
Volatilidad

```{r eval=TRUE, echo=FALSE}
# Volatilidad
Serie_2 <- empleo$Serie_2

vol_s2 <- sd(Serie_2, na.rm = T)

```
La volatilidad de esta tasa de crecimiento, medido por la desviación estándar es de `r vol_s2`

\clearpage

  + Obtenga del INEGI una serie anual del producto interno bruto en términos 
  reales, calcule su tasa de cambio anual, calcule su volatilidad. (Serie 3)
  

Cambio Porcentual y Volatilidad de Serie 3

```{r} 
#Cambio Porcentual

datos <- read_excel("PIB_K.xls",
                     sheet = 1) 

names(datos) = c('Periodo', 'Inversión', 'Indice K','PIB')

datos <- datos[-c(1:200),-c(2,3)]

datos$Periodo <- year(parse_date_time(datos$Periodo, orders = "%Y%q"))

datos <- na.omit(datos)
  
datos$PIB <- as.numeric(as.character(datos$PIB)) 

datos <- datos %>% group_by(Periodo) %>% summarise(PIB, PIB_an = mean(PIB), .groups = 'drop')

datos <- datos[!duplicated(datos[c('PIB_an')]),] 

datos <- datos[,-2]

datos_pib <- datos %>% mutate(Serie_3 = (PIB_an/lag(PIB_an)-1)*100) 

datos_pib <- na.omit(datos_pib)

knitr::kable(
  datos_pib, booktabs = TRUE, format = 'latex', col.names = c("Año", "Producto Interno Bruto","Variación %"),
  caption = "Variación Porcentual de los Salarios Reales (2008 - 2021)", longtable = F
)%>%
  kable_styling(latex_options = "hold_position")
```
Volatilidad

```{r eval=TRUE, echo=FALSE}
#Volatilidad
Serie_3 <- datos_pib$Serie_3
vol_s3 <- sd(Serie_3, na.rm = T)

```
La volatilidad de esta tasa de crecimiento, medido por la desviación estándar es de `r vol_s3`
\clearpage
  
  + Grafique las tres series de tasas de cambios de forma que se puedan comparar.
  
```{r fig.cap='Comparación de Variación Porcentual entre Series\\label{graf1}'}
Series <- datos_pib[,c(1,3)]

year <- datos_pib$Periodo
year <- year[-c(1,2)]
Serie1 <- salr$Serie_1
Serie2 <- empleo$Serie_2
Serie2 <- Serie2[-c(1,2)]
Serie3 <- datos_pib$Serie_3
Serie3 <- Serie3[-c(1,2)]


Series <- data.frame(year, Serie1, Serie2, Serie3)

pacman::p_load(extrafont)

meltdf <- melt(Series,id="year")
gg <- ggplot(meltdf,aes(x=year,y=value,colour=variable,group=variable)) + geom_line() + 
  labs(title = "Comparación de Variación Porcentual entre Series", x="Año",y='Variación Porcentual', 
      colour = " ") + theme_bw() +  theme(text=element_text(size=12,  family="serif"))

plot(gg) 

```
 \clearpage 
  + Calcule la covarianza de la serie 1 con la 3 y de la 2 con la 3.

La covarianza entre Serie 1 y Serie 3 es:
```{r eval=TRUE, echo=FALSE}
# cov(Serie1[-1], Serie3[-1])
```
\begin{center}
$Cov(Serie_1, Serie_3) =$ `r cov(Serie1[-1], Serie3[-1])`
\end{center}

La covarianza entre Serie 2 y Serie 3 es :

\begin{center}
$ Cov(Serie_2, Serie_3) = $ `r cov(Serie_2, Serie_3)`
\end{center}

  
```{r eval=TRUE, echo=FALSE}
# cov(Serie_2, Serie_3)
```


  + Explique si sus resultados son o no consistentes con los hechos estilizados
  para EEUU que se discutieron en clase.

El primer hecho estilizado es que el desempleo parece ser el mismo a lo largo de la historia. La tasa de desempleo no fue requerida en algún inciso del ejercicio, pero una [sencilla búsqueda en internet](https://www.proyectosmexico.gob.mx/por-que-invertir-en-mexico/mercado-potencial/sd_historico-tasa-de-desempleo-en-mexico/), puede confirmar este hecho estilizado. Históricamente, tasa de desempleo fluctúa alrededor de 3.5\%. 

El segundo hecho estilizado nos dice que el nivel de empleo fluctúa con el ciclo económico, pero los salarios parecen tener nada que ver con tal ciclo. Como puede observarse en la gráfica (y como bien lo enfatiza las respectivas varianzas), México cumple con este segundo hecho estilizado con respecto a el salario real. Además, puede observarse que los cambios en el mercado laboral sí fluctúan muy similar al ciclo económico.

\clearpage

**3. Contraste un modelo trivial de la determinación del salario con los datos siguiendo estos pasos:**


+ Obtenga una serie del PIB $Y_t$ de la economía.

```{r} 
#Cambio Porcentual

datos <- read_excel("PIB_K.xls",
                     sheet = 1) 

names(datos) = c('Periodo', 'Inversión', 'Indice_K','PIB')
datos <- datos[-c(1:200),-2]
PIB <- datos[,-2]
PIB$Periodo <- year(parse_date_time(datos$Periodo, orders = "%Y%q"))
PIB <- na.omit(PIB)
PIB$PIB <- as.numeric(as.character(PIB$PIB)) 
PIB <- PIB %>% group_by(Periodo) %>% summarise(PIB, PIB_an = mean(PIB), .groups = 'drop')
PIB <- PIB[!duplicated(PIB[c('PIB_an')]),] 
PIB <- PIB[,-2]

```
+ Obtenga una serie del capital $K_t$ de la economía (``Indice de Volumen físico acumulado´´).

```{r}
K <- datos[,-3]
K$Periodo <- year(parse_date_time(K$Periodo, orders = "%Y%m"))
K$Indice_K <- as.numeric(as.character(K$Indice_K)) 
K <- K %>% group_by(Periodo) %>% summarise(Indice_K, K_an = mean(Indice_K), .groups = 'drop')
K <- K[!duplicated(K[c('K_an')]),]
K <- na.omit(K)
K <- K[,-2]

```
+ Obtenga una serie del empleo $L_t$ de la economía.
```{r}

empleo <- read_excel("Empleo.xls",
                     sheet = 1) 

empleo$Periodos <- year(parse_date_time(empleo$Periodos, orders = "%Y/%q"))
empleo <- empleo %>% group_by(Periodos) %>% summarise(`PEA Ocupada`, PEA_Ocup_an = mean(`PEA Ocupada`, na.rm=T), .groups = 'drop')

empleo <- empleo[!duplicated(empleo[c('PEA_Ocup_an')]),]
empleo <- empleo


```
+ Cree una serie de la productividad $A_t$ de la economía a partir de asumir una función de producción $Y_t=A_tF(K,L)$, con $F(K,L)=K^{0.3}L^{0.7}$.

$$
\text{Productivadad}=A_t=\frac{Y_t}{F(K,L)}=\frac{Y_t}{K^{0.3}L^{0.7}}
$$
```{r}
productividad <- empleo[,-2]
A <- PIB$PIB_an/(((K$K_an)^(0.3))*((empleo$PEA_Ocup_an)^(0.7)))
A <- as.vector(A, mode = "numeric")
A <- as.data.frame(A,t(A))
productividad <- productividad %>% add_column(A_t=A$A)
```
+ Cree una serie contrafactual del salario que se debió de haber observado si el salario fuera el ingreso marginal del trabajo $A_tF_L(K_t,L_t)$.

$$
w_t= \frac{\partial Y_t}{\partial L}= \frac{\partial A_tF_L(K_t,L_t)}{\partial L}=0.7(A_tK^{0.3}L^{0.3})
$$
```{r}
salario <- empleo[,-2]
w <- (0.7)*(productividad$A_t)*((K$K_an)^(0.3))*((empleo$PEA_Ocup_an)^(0.3))
w <- as.vector(w, mode = "numeric")
w <- as.data.frame(w,t(w))
salario <- salario %>% add_column(w=w$w)

```

## Ejercicio 5
**5. Practique trabajar con datos laborales de México siguiendo estos pasos:**

+ Descargue los micro-datos de la ENOE (también del INEGI), correspondientes a los cuatro trimestres de 2019.

Los datos para este ejercicio se recuperaron del [INEGI](https://www.inegi.org.mx/programas/enoe/15ymas/#Microdatos) en formato dta.

+ Calcule el desempleo en cada trimestre, explicando cómo lo calculó.

```{r}

t119 <- read_csv("sdemt119.csv")
t219 <- read_csv("sdemt219.csv")

t319 <- read_csv("sdemt319.csv")
names(t319) <- tolower(names(t319))

t419 <- read_csv("sdemt419.csv")
names(t419) <- tolower(names(t419))

#Población Econóicamente Activa 
PEA1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase1 == 1) %>% summarise(sum(fac)))

PEA2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase1 == 1) %>% summarise(sum(fac)))

PEA3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase1 == 1) %>% summarise(sum(fac)))

PEA4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase1 == 1) %>% summarise(sum(fac)))

#Población Ocupada
PO1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 1) %>% summarise(sum(fac)))

PO2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 1) %>% summarise(sum(fac)))

PO3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 1) %>% summarise(sum(fac)))

PO4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 1) %>% summarise(sum(fac)))


#Población Desocupada
PD1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 2) %>% summarise(sum(fac)))

PD2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 2) %>% summarise(sum(fac)))

PD3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 2) %>% summarise(sum(fac)))

PD4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 2) %>% summarise(sum(fac)))

#Tasa de desempleo

U_1 <- (PD1/PEA1)*100
U_2 <- (PD2/PEA2)*100
U_3 <- (PD3/PEA3)*100
U_4 <- (PD4/PEA4)*100

```
La tasa de desempleo está dada por la siguiente expresión 
$$\text{Tasa de desempleo} = \frac{\text{Población Desocupada}}{\text{Población Económicamente Activa}}*100$$

```{r}
unemp <- data.frame(Desempleo = c(U_1,U_2,U_3,U_4), 
                    row.names = c('Trimestre I','Trimestre II','Trimestre III','Trimestre IV'))
knitr::kable(unemp, booktabs = TRUE, format = 'latex', longtable = F
)%>%
  kable_styling(latex_options = "hold_position", "center")

unemp_ <- data.frame(Trimestre = c(' I',' II',' III',' IV'),
                     desmp = c(U_1,U_2,U_3,U_4))

g1 <- ggplot(unemp_, aes(Trimestre,desmp)) + geom_bar(stat = "identity", fill = "darkolivegreen2", color = "black", width = 0.6) + theme_bw() + labs(title = "Tasa de Desempleo 2019", xlab = " Trimestre ", y="Porcentaje") +  theme(text=element_text(size=12,  family="serif"))

g1

```

+ Calcule el subempleo en cada trimestre, explicando cómo lo calculó.

El subempleo refiere a la condición de aquellas personas que tienen trabajo pero que no laboran todas las horas que quieren por cuestiones del mercado laboral. La fórmula está dada por: 
$$
\text{Tasa de Subocupación} = \frac{\text{Población Subocupada}}{\text{Población Ocupada}}*100
$$

```{r}
#Población Subocupada

Sub1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, sub_o==1) %>% summarise(sum(fac)))

Sub2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, sub_o==1) %>% summarise(sum(fac)))

Sub3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, sub_o==1) %>% summarise(sum(fac)))

Sub4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, sub_o==1) %>% summarise(sum(fac)))

#Tasa de Subocupación

Tsub_1 <- (Sub1/PO1)*100
Tsub_2 <- (Sub2/PO2)*100
Tsub_3 <- (Sub3/PO3)*100
Tsub_4 <- (Sub4/PO4)*100

suboc <- data.frame(Subempleo = c(Tsub_1, Tsub_2, Tsub_3, Tsub_4), 
                    row.names = c('Trimestre I','Trimestre II','Trimestre III','Trimestre IV'))
knitr::kable(suboc, booktabs = TRUE, format = 'latex', longtable = F
)%>%
  kable_styling(latex_options = "hold_position", "center")

suboc_ <- data.frame(Trimestre = c(' I',' II',' III',' IV'),
                     subOC = c(Tsub_1, Tsub_2, Tsub_3, Tsub_4))

g2 <- ggplot(suboc_, aes(Trimestre,subOC)) + geom_bar(stat = "identity", fill = "darkorange2", color = "black", width = 0.6) + theme_bw() + labs(title = "Tasa de Subempleo 2019", xlab = " Trimestre ", y="Porcentaje") +  theme(text=element_text(size=12,  family="serif"))

g2


```



+ Calcule la fracción de trabajadores fuera de la fuerza laboral, pero disponibles para trabajar, en cada trimestre, explicando cómo lo calculó.

La Población Disponible es un elemento de la Población No Económicamente Activa (PNEA), y representa a aquellas personas que, por alguna razón, no están en búsqueda activa de empleo, pero que si se les presentara la oportunidad de trabajar la tomarían. Esto puede deberse a que, después de cierto tiempo de búsqueda, la persona deja de buscar por resignación.

Llamaremos Tasa de Disponibilidad a la fracción referida en el enunciado del problema, la cual está dada por la siguiente expresión:

$$
\text{Tasa de Disponibilidad} = \frac{\text{Población Disponible}}{\text{PNEA}}*100
$$

La PNEA es simplemente la suma de la Población Disponible y la No Disponible.

Así, tenemos la siguiente tabla que resume esta tasa en los trimestres del 2019:

```{r}
#Población Disponible
disp1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 3, clase1==2) %>% summarise(sum(fac)))
disp2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 3, clase1==2) %>% summarise(sum(fac)))
disp3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 3, clase1==2) %>% summarise(sum(fac)))
disp4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 3, clase1==2) %>% summarise(sum(fac)))
#Población No Disponible
nd1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 4, clase1==2) %>% summarise(sum(fac)))
nd2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 4, clase1==2) %>% summarise(sum(fac)))
nd3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 4, clase1==2) %>% summarise(sum(fac)))
nd4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 4, clase1==2) %>% summarise(sum(fac)))
#La Población No Económicamente Activa está tada por Pob. Disponible + Pob. No Disponible.
#Por lo tanto, la fracción de trabajadores disponibles está dada por Pob. Disponible / (Pob. Disponible + Pob. No Disponible)
Td1 <- disp1/(disp1 + nd1)*100
Td2 <- disp2/(disp2 + nd2)*100
Td3 <- disp3/(disp3 + nd3)*100
Td4 <- disp4/(disp4 + nd4)*100
disp <- data.frame(Disponibilidad = c(Td1, Td2, Td3, Td4), 
                    row.names = c('Trimestre I','Trimestre II','Trimestre III','Trimestre IV'))
knitr::kable(disp, booktabs = TRUE, format = 'latex', longtable = F, caption = "Tasas de disponibilidad 2019"
)%>%
  kable_styling(latex_options = "hold_position", "center")
disp_ <- data.frame(Trimestre = c(' I',' II',' III',' IV'),
                     Dispt = c(Td1, Td2, Td3, Td4))
g3 <- ggplot(disp_, aes(Trimestre,Dispt)) + geom_bar(stat = "identity", fill = "lightblue", color = "black", width = 0.6) + theme_bw() + labs(title = "Tasa de Disponibilidad 2019", xlab = " Trimestre ", y="Porcentaje") +  theme(text=element_text(size=12,  family="serif"))
g3
```
+ Calcule qué fracción de los trabajadores trabaja en empresas chicas, medianas y grandes.

Defininamos el total de personas que trabajan en este tipo de empresas, sin considerar micronegocios o personas que laboran en el sector público, como la suma: chicas + medianas + grandes. Así, las tasas (fracciones) estarán dadas por:

$$
\text{Tasa}_{it} = \frac{\text{Tamaño}_{it}}{\text{Total}_t}*100 ,
$$
en donde $i$ denota el tamaño de la empresa y $t$ el trimestre.

Presentamos también los valores absolutos.
```{r}
#Empleados en establecimientos pequeños
peq1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==4 ) %>% summarise(sum(fac)))
peq2<- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==4 ) %>% summarise(sum(fac)))
peq3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==4) %>% summarise(sum(fac)))
peq4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==4) %>% summarise(sum(fac)))
#Empleados en establecimientos medianos
med1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==5) %>% summarise(sum(fac)))
med2<- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==5) %>% summarise(sum(fac)))
med3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==5) %>% summarise(sum(fac)))
med4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==5) %>% summarise(sum(fac)))
#Empleados en establecimientos grandes
gra1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==6) %>% summarise(sum(fac)))
gra2<- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==6) %>% summarise(sum(fac)))
gra3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==6) %>% summarise(sum(fac)))
gra4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==6) %>% summarise(sum(fac)))
tamano <- data.frame(Pequeña = c(peq1,peq2,peq3,peq4),
                     Mediana = c(med1,med2,med3,med4),
                     Grande = c(gra1, gra2, gra3, gra4),
                     row.names = c('Trimestre I','Trimestre II', 'Trimestre III','Trimestre IV'))
tamano <- tamano %>% mutate(tamano, Total = Pequeña + Mediana + Grande)
knitr::kable(tamano, booktabs = TRUE, format = 'latex', longtable = F, 
             caption = "Numero de empleados por tamaño de empresa"
)%>%
  kable_styling(latex_options = "hold_position", "center")
tit <- data.frame(Pequeña = c(peq1/(peq1+med1+gra1),peq2/(peq2+med2+gra2),peq3/(peq3+med3+gra3),peq4/(peq4+med4+gra4))*100,
                     Mediana = c(med1/(peq1+med1+gra1),med2/(peq2+med2+gra2),med3/(peq3+med3+gra3),med4/(peq4+med4+gra4))*100,
                     Grande = c(gra1/(peq1+med1+gra1), gra2/(peq2+med2+gra2), gra3/(peq3+med3+gra3), gra4/(peq4+med4+gra4))*100,
                     row.names = c('Trimestre I','Trimestre II', 'Trimestre III','Trimestre IV'))
knitr::kable(tit, booktabs = TRUE, format = 'latex', longtable = F, 
             caption = "Numero de empleados por tamaño de establecimiento"
)%>%
  kable_styling(latex_options = "hold_position", "center")
Pequeña <- c(peq1,peq2,peq3,peq4)
Mediana <- c(med1,med2,med3,med4)
Grande <- c(gra1,gra2,gra3,gra4)
tamano2 <- data.frame(Trimestre = c('Trimestre I','Trimestre II', 'Trimestre III','Trimestre IV'),
                      Tamaño = c(Pequeña,Mediana,Grande),
                      nombre = c(rep('Pequeña',4), rep('Mediana', 4), rep('Grande',4)))
pacman::p_load(scales)

ggplot(tamano2,aes(x = nombre, y =Tamaño, fill = Trimestre)) +
geom_bar(stat = "identity", position = "dodge" ) +
  labs(title = "Número de empleados por tamaño de empresas (2019)", x="Tamaño de Empresa",y='Número de Empleados') + theme_bw() +  theme(text=element_text(size=12,  family="serif")) + scale_y_continuous(labels = comma)
```

+ Calcule qué fracción de los trabajadores está buscando otro empleo.

Resulta interesante conocer estas cifras, ya que el mercado laboral experimenta "presiones" que provienen de aquellos individuos en situación de búsqueda de trabajo. En este rubro no sólo entran las personas desocupadas, sino también las que ya tienen trabajo pero por alguna razón quieren encontrar otro.

```{r}
busq1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, tpg_p8a == 1) %>% summarise(sum(fac)))

busq2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  tpg_p8a == 1) %>% summarise(sum(fac)))

busq3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  tpg_p8a == 1) %>% summarise(sum(fac)))

busq4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  tpg_p8a == 1) %>% summarise(sum(fac)))

busq <- data.frame(Busqueda = c(busq1, busq2, busq3, busq4), 
                    row.names = c('Trimestre I','Trimestre II','Trimestre III','Trimestre IV'))
knitr::kable(busq, booktabs = TRUE, format = 'latex', longtable = F, caption = "Empleados en búsqueda de otro empleo 2019"
)%>%
  kable_styling(latex_options = "hold_position", "center")

busq_ <- data.frame(Trimestre = c(' I',' II',' III',' IV'),
                     busqu = c(busq1, busq2, busq3, busq4))

g3 <- ggplot(busq_, aes(Trimestre,busqu)) + geom_bar(stat = "identity", fill = "blue", color = "black", width = 0.6) + theme_bw() + labs(title = "Número de empleados en búsqueda de otro trabajo 2019", xlab = " Trimestre ", y="Porcentaje") +  theme(text=element_text(size=12,  family="serif")) +  scale_y_continuous(label = comma)
g3

```


+ Grafique la relación entre el ingreso promedio y la edad de los trabajadores.


```{r echo = FALSE, fig.cap = "Relación entre Edad e Ingreso"}

a <- t119 %>%
           filter(clase1 == 1, eda == 15)%>%
          summarise(avg_ing= mean(ing_x_hrs))
a <- as.numeric(a)

b <- t119 %>%
           filter(clase1 == 1, eda == 20)%>%
          summarise(avg_ing= mean(ing_x_hrs))
b <- as.numeric(b)

c <- t119 %>%
           filter(clase1 == 1, eda == 25)%>%
          summarise(avg_ing= mean(ing_x_hrs))
c <- as.numeric(c)

d <- t119 %>%
           filter(clase1 == 1, eda == 30)%>%
          summarise(avg_ing= mean(ing_x_hrs))
d <- as.numeric(d)

e <- t119 %>%
           filter(clase1 == 1, eda == 35)%>%
          summarise(avg_ing= mean(ing_x_hrs))
e <- as.numeric(e)

f <- t119 %>%
           filter(clase1 == 1, eda == 40)%>%
          summarise(avg_ing= mean(ing_x_hrs))
f <- as.numeric(f)

g <- t119 %>%
           filter(clase1 == 1, eda == 45)%>%
          summarise(avg_ing= mean(ing_x_hrs))
g <- as.numeric(g)

h <- t119 %>%
           filter(clase1 == 1, eda == 50)%>%
          summarise(avg_ing= mean(ing_x_hrs))
h <- as.numeric(h)

i <- t119 %>%
           filter(clase1 == 1, eda == 55)%>%
          summarise(avg_ing= mean(ing_x_hrs))
i <- as.numeric(i)

j <- t119 %>%
           filter(clase1 == 1, eda == 60)%>%
          summarise(avg_ing= mean(ing_x_hrs))
j <- as.numeric(j)

k <- t119 %>%
           filter(clase1 == 1, eda == 65)%>%
          summarise(avg_ing= mean(ing_x_hrs))
k <- as.numeric(k)

l <- t119 %>%
           filter(clase1 == 1, eda == 70)%>%
          summarise(avg_ing= mean(ing_x_hrs))
l <- as.numeric(l)

m <- t119 %>%
           filter(clase1 == 1, eda == 75)%>%
          summarise(avg_ing= mean(ing_x_hrs))
m <- as.numeric(m)

n <- t119 %>%
           filter(clase1 == 1, eda == 80)%>%
          summarise(avg_ing= mean(ing_x_hrs))
n <- as.numeric(n)

o <- t119 %>%
           filter(clase1 == 1, eda == 85)%>%
          summarise(avg_ing= mean(ing_x_hrs))
o <- as.numeric(o)

p <- t119 %>%
           filter(clase1 == 1, eda == 90)%>%
          summarise(avg_ing= mean(ing_x_hrs))
p <- as.numeric(p)


Ingreso <- c(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p)

Edad <- c(15,20,25,30,25,40,45,50,55,60,65,70,75,80,85,90)
df <- data.frame(Edd = Edad, ing = Ingreso)

ggplot(df, aes(Edd,ing)) + geom_point(colour="brown", size=2.5) + labs(title = "Relación entre Edad e Ingreso (2019)", x="Edad",y="Ingreso por hora") + theme_bw() +  theme(text=element_text(size=12,  family="serif"))



```



