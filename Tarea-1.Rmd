---
output: 
  pdf_document:
    includes:
      before_body: portada.tex
      in_header: 
    toc: true
    toc_depth: 3
  tables: true
include-before:
- '`\newpage{}`{=latex}'
toc-title: Contenido
urlcolor: blue
header-includes:
- \usepackage[nottoc]{tocbibind}
- \renewcommand{\listfigurename}{Lista de figuras}
- \renewcommand{\listtablename}{Lista de tablas}
- \usepackage[utf8]{inputenc}
- \usepackage[spanish]{babel}
- \usepackage{graphicx}
- \usepackage{float}
- \usepackage{lscape}
---

\newpage

\listoffigures

\listoftables

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.align="center", fig.pos = "H", fig.width = 7, fig.height = 3)
```

\newpage

# Preguntas teóricas
**1. Resuelva los ejercicios 11.2 y 11.9 (5a Ed.). Realice estos con ayuda de su 
laboratorista y entregue las soluciones a máquina, utilizando LaTeX.**

## Ejercicio 11.2, Romer (5ta Edicion)

\begin{enumerate}
\item[] \textbf{11.2} Efficiency wages and bargaining. (Garino and Martin, 2000). Summers (1988), p.386) states, 
$"$In an effiency wage environment, firms that are forced to pay their workers preminum wages suffer only second-order losses. In almost any plausible bargaining framework, this makes it easier for workers to extract concessions." This problem asks you to investigate this claim.
\end{enumerate}
Consider a firm with profits given by $\pi=[\frac{(eL)^{\alpha}}{\alpha}]-wL$, $0<\alpha<1$, and a union with objective function $U=(w-x)L$, where x is an index of its workers'outside opportunities. Assume that the firm and the union bargain over the wage, and that the firm then chooses L taking w as given.

### Ejercicio (a)
\begin{enumerate}
\item[] \textit{a. Suppose that e is fixed at 1, so that the effiency-wage considerations are absent.}
\end{enumerate}

\centerline{\textbf{ a.1. }What value of L does the firm choose, given w$?$ what is the resulting level of profits$?$.}

Si $e=1$ y w está dado, el problema de la firma es elegir L para maximizar sus beneficios:
$$ \max\limits_{L}\pi=  \frac{L^{\alpha}}{\alpha}-wL  $$
CPO:
$$ \frac{\partial \pi}{\partial L}: \alpha \frac{L^{\alpha -1}}{\alpha}-w =0  $$
$$ \Rightarrow L^{\alpha -1} = w $$
$$ \Rightarrow L^*=w^{\frac{1}{\alpha -1}}$$
Sustituimos L* en $\pi$ obtenemos $\pi^*$, donde la empresa maximiza el beneficio dado $w$

$$ \pi^*= \frac{{\left(w^{\frac{1}{\alpha-1}} \right)}^{\alpha}}{\alpha} - w \left (w^{\frac{1}{\alpha-1}} \right )= \frac{w^{\frac{\alpha}{\alpha-1}}-\alpha w^{\frac{\alpha}{\alpha-1}}}{\alpha}$$

$$  \Rightarrow \pi^*= \left (\frac{1- \alpha}{\alpha} \right )w^{\frac{1}{\alpha-1}} $$

\begin{enumerate}
\item[] \textbf{ a.2. }Suppose that the firm and the union choose w to maximize ${U}^{\gamma}{\pi}^{1- \gamma}$ , where $0 <{\gamma} <  {\alpha }$ indexes the union’s power in the bargaining. What level of w do they choose$?$
\end{enumerate}

$$\max\limits_{w}{U}^{\gamma}{\pi^*}^{1- \gamma} $$
Sustiuimos el nivel de $L^*$ en la función objetivo del sindicato, $(w-x)L^*$:
$$\max\limits_{w} [(w-x)L^*]^{\gamma} \left[ \left (\frac{1- \alpha}{\alpha} \right)w^{\frac{1}{\alpha-1}} \right]^{1- \gamma}$$
Tomamos el logaritmo natural de ${U}^{\gamma}{\pi}^{1- \gamma}$ y derivamos con respecto a este, con la finalidad de simplificar los cálculos, tenemos entonces:

$$\max\limits_{w} \gamma \left[\ln(w-x)+\frac{1}{\alpha -1} \ln(w) \right]
+ (1- \gamma)\left[ \ln \left( \frac{1- \alpha}{\alpha} \right) + \left (\frac{\alpha}{\alpha-1} \right )ln(w) \right]
$$
CPO:

$$
\frac{\partial {U}^{\gamma}{\pi}^{1- \gamma}}{\partial w}: \frac{\gamma}{w-x} + \frac{ \gamma}{w( \alpha-1)}+ \frac{ \alpha(1- \gamma)}{w( \alpha -1)}=0
$$
$$
\Rightarrow \frac{ \gamma}{w-x}=- \left [ \frac{ \gamma + \alpha - \alpha \gamma}{w( \alpha-1)}\right ]=- \left[ \frac{ \alpha + \gamma (1- \alpha)}{w( \alpha-1)} \right]
$$
$$
\Rightarrow \gamma = - \left [ \frac{ \alpha+ \gamma(1- \alpha)}{w( \alpha-1)} \right](w-x)=\frac{- \alpha -\gamma (1- \alpha)}{ \alpha -1}+ \frac{x( \alpha + \gamma (1- \alpha))}{w(\alpha -1)}
$$
$$
\Rightarrow \frac{x( \alpha + \gamma (1- \alpha))}{w(\alpha -1)} = \gamma +\frac{ \alpha +\gamma (1- \alpha)}{ \alpha -1}= \frac{\alpha}{\alpha -1}
$$
Por tanto, el salario escogido durante el proceso de negociación es:
$$
\Rightarrow w^*=\frac{x( \alpha + \gamma (1- \alpha))}{\alpha}
$$

### Ejercicio (b)
\begin{enumerate}
\item[] \textit{b. Suppose that e is given by equation (11.12) in the text: $e=[\frac{(w-x}{x}]^{\beta}$ for  $w>x$ where $0<\beta <1$.}
\end{enumerate}
\centerline{\textbf{ b.1.} What value of L does the firm choose, given w$?$, What is the resulting level of profits$?$}

Ahora vamos a encontrar $L^*$ que maximiza $\pi$ en presencia de una ecuación de esfuerzo.
$$
\max\limits_{L}\pi= \frac{ \left ( \left ( \frac{w-x}{x} \right )^ \beta L \right )^{\alpha}}{\alpha}-wL
$$
CPO:
$$
\frac{\partial \pi}{\partial L}: \frac{ \alpha \left ( \left ( \frac{w-x}{x} \right )^ \beta L \right )^{\alpha-1}}{\alpha}-w=0
$$
$$
\Rightarrow w= \left (  \frac{w-x}{x} \right )^ {\alpha \beta} L^{\alpha-1}
$$
$$
\Rightarrow L^{\alpha -1}=w \left( \frac{x}{w-x} \right )^{\alpha \beta}
$$
$$
\Rightarrow L^*= \left ( w \left( \frac{x}{w-x} \right )^{\alpha \beta} \right)^{\frac{1}{\alpha -1}}= \left(\frac{w-x}{x} \right)^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{1}{\alpha -1}}
$$
Sustituimos L* en $\pi$, así como hicimos en pasos anteriors, y obtenemos $\pi^*$, donde la empresa maximiza el beneficio dado $w$
$$
\pi^*= \frac{ \left[ \left (\frac{w-x}{x} \right )^\beta \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{1}{\alpha -1}} \right ]^\alpha}{\alpha}-w \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{1}{\alpha -1}}
$$
De tal modo que este es el beneficio óptimo al nivel dado de salarios en presencia de una ecuación de esfuerzo.
$$
\Rightarrow \pi^*= \frac{ \left[  \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{\alpha}{\alpha -1}} \right ]}{\alpha}- \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{\alpha}{\alpha -1}}=\left( \frac{1- \alpha}{\alpha} \right ) w^{\frac{\alpha}{\alpha -1}} \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}} 
$$
 \begin{enumerate}
\item[] \textbf{b.2. }Suppose that the firm and the union choose w to maximize ${U}^{\gamma}{\pi}^{1- \gamma}$, $0<{\gamma} < {\alpha}$ What level of w do they choose? (Hint: For the case of $\beta =0$, your answer should simplify to your answer in part [a][ii].)
\end{enumerate}

Vamos a sustituir el nivel de $L^*$ obtenido en el inciso anterior en la función objetivo del sindicato, $(w-x)L^*$: 
$$\max\limits_{w}{U}^{\gamma}{\pi^*}^{1- \gamma} $$
$$
\max\limits_{w} \left[ (w-x) \left (\frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}}w^{\frac{-1}{1- \alpha }}\right ]^{\gamma} \left[ \left( \frac{1- \alpha}{\alpha} \right ) w^{\frac{- \alpha}{1- \alpha}} \left( \frac{w-x}{x} \right )^{\frac{\alpha \beta}{1- \alpha}} \right]^{1- \gamma}
$$

Aplicamos logaritmo natural y derivando como en el inciso anterior, obtenemos:

$$
\max\limits_{w} \gamma \left[ \ln(w-x) + \left (\frac{\alpha \beta}{1- \alpha} \right ) \ln \left (\frac{w-x}{x} \right )- \left( \frac{1}{1- \alpha} \right ) w \right ]+ (1- \gamma) \left[\ln \left( \frac{1- \alpha}{\alpha} \right ) - \left (\frac{\alpha}{1- \alpha } \right) \ln( w) + \left (\frac{\alpha \beta}{1- \alpha} \right ) \ln \left( \frac{w-x}{x} \right ) \right]
$$

CPO:
$$
\frac{\partial \ln U^{\gamma}{\pi^*}^{1- \gamma}}{\partial w}: \gamma \left[ \left(\frac{1- \alpha + \alpha \beta}{1- \alpha}\right ) \left (\frac{1}{w-x} \right )- \left( \frac{1}{1- \alpha}\right ) \left( \frac{1}{w}\right) \right]+(1- \gamma) \left[ - \left ( \frac{\alpha}{1- \alpha} \right ) \left( \frac{1}{w} \right ) + \left( \frac{ \alpha \beta}{1- \alpha} \right ) \left (\frac{1}{w-x} \right ) \right]=0
$$
$$
\Rightarrow \left( \frac{1}{w-x}\right) \left( \frac {\gamma -\alpha \gamma + \alpha \beta}{1- \alpha}\right)=\left ( \frac{1}{w} \right ) \left(\frac{- \gamma - \alpha +\alpha \gamma}{1- \alpha} \right)
$$
$$
\Rightarrow w(\gamma -\alpha \gamma + \alpha \beta)=(w-x)(- \gamma - \alpha +\alpha \gamma)
$$
$$
\Rightarrow \alpha \beta w - \alpha w= \alpha \gamma x - \gamma x - \alpha x
$$

Así encontramos el salario óptimo fijado por la empresa y el sindicato cuando existe una ecuación de esfuerzo.
$$
\Rightarrow w^*= \frac{x( \alpha \gamma -\gamma - \alpha )}{\alpha \beta- \alpha}=\frac{x( \alpha + \gamma (1- \alpha))}{\alpha (1- \beta)}
$$

Cuando evaluamos $w^*$ en $\beta =0$ obtenemos:
$$
 w^* \rvert_{\beta=0}=\frac{x( \alpha + \gamma (1- \alpha))}{\alpha (1- 0)}=\frac{x( \alpha + \gamma (1- \alpha))}{\alpha}
$$
Lo cual es igual al resultado obtenido en la segunda parte del inciso a).

 \begin{enumerate}
\item[] \textbf{b.3. }Is the proportional impact of workers’ bargaining power on wages greater with efficiency wages than without, as Summers implies? Is it greater when efficiency-wage effects, $\beta$, are greater?
\end{enumerate}

Para comprobar en que caso tiene más poder de negociación el sindicato vamos a utilizar los resultados del salario optimo $w^*$ que se encuentra la parte ii de los incisos a) y b), en b hay salarios de eficiencia.
Donde el subíndice s representa la ausencia de ecuación de esfuerzo y $\beta$ para cuando si hay ecuación de esfuerzo en los salarios.
$$
w^*_s= \frac{x( \alpha + \gamma (1- \alpha))}{\alpha} \quad\textrm{VS}\quad w^*_\beta =\frac{x( \alpha + \gamma (1- \alpha))}{\alpha (1- \beta)}
$$
Podemos notar fácilmente que el numerador de ambos salarios óptimos es igual por lo que lo podemos eliminar para la comparación.
$$
w^*_s= \frac{1}{\alpha} \quad\text{VS}\quad w^*_\beta =\frac{1}{\alpha (1- \beta)}
$$
Si recordamos $0< \beta <1$ es evidente que $\alpha (1- \beta )< \alpha$ por lo cual tendremos que:
$$
w_s^*<w_ \beta ^*
$$

Y esto quiere decir que en presencia de salarios de eficiencia el sindicato tiene la posibilidad de negociar un salario óptimo más alto que cuando no existen salarios de eficiencia (una ecuación de esfuerzo).
Ahora pasamos a analizar que sucede a cuando $\beta$ aumenta.

$$
\frac{ \partial w_ \beta ^*}{ \partial \beta}=x( \alpha + \gamma (1- \alpha)) \left [ \frac{\alpha}{(\alpha(1- \beta))^2} \right ]
$$

Claramente podemos ver que entre mayor sea $\beta$ menor sera el denominador lo cual nos entregará un salario más alto; es decir, a mayor $\beta$ será mayor el poder de negociación del sindicato.



## Ejercicio 11.9, Romer (5ta Edicion)

\begin{enumerate}
\item[] \textbf{11.9. The Harris Todaro model.} (Harris and Todaro, 1970.) Suppose there are two sectors. Jobs in the primary sector pay $w_p$; jobs in the secondary sector pay $w_s$; Each worker decides which sector to be in. All workers who choose the secondary sector obtain a job. But there are a fixed number, $N_p$, of primary$-$sector jobs. These jobs are allocated at random among workers who choose the primary sector. Primary$-$sector workers who do not get a job are unemployed, and receive an unemployment benefit of b.Workers are risk$-$ neutral, and there is no disutility of working. Thus the expected utility of a primary$-$sector worker is $q w_p + (1-q)*b$, where $q$ is the probability of a primary $-$  worker getting a job. Assume that $b<w_s<w_p$, and that:
$$\frac{N_p}{N} < \frac{w_s -b }{w_p -b} $$
\end{enumerate}
### Ejercicio (a) 
\begin{enumerate}
\item[] \textit{What is equilibrium unemployment as a function of $w_p$, $w_s$, $N_p$, b, and the size of the labor force,  $\overline{N}?$}
\end{enumerate}

En equilibrio, el número de personas en el sector primario será igual al número de personas empleadas, lo que es igual al número de trabajos en el sector primario, $N_p$, más el número de personas desempleadas en la economía U.
$$
\quad\text{Personas en sector primario} = N_p + U
$$
Dado que los individuos son contratados aleatoriamente en el sector primario, en equilibrio, la probabilidad de obtener un trabajo en el sector primario, q, es igual al número total de trabajos $N_p$ dividido por el total de personas en el sector primario, Np + U. Por tanto:
$$
q = \frac{N_p}{N_p + U} 
$$
ademas,  equilibrio, la utilidad esperado de elegir el sector primario $q w_p + (1-q)b$ debe ser igual a la utilidad esperada de escoger el sector secundario $w_S$. Así, en equilibrio:
$$
q w_p + (1-q)b=w_s
$$
Resolviendo para $q$, obtenemos:
$$
q=\frac{w_s-b}{w_p-b}
$$
Por lo que tenemos ahora dos condiciones que debe satisfacer $q$  en equilibrio. Igualando ambas condiciones obtenemos
$$
\frac{N_p}{N_p + U}=\frac{w_s-b}{w_p-b}
$$
Que puede ser reescrita como:
$$
{N_p} (w_p-b){}={(w_s-b)}{(N_p + U)}= U*(w_s-b)+N_p*(w_s-b)
$$
Y resolviendo para el desempleo de equilibrio, encontramos:
$$
U=\frac{N_p (w_p-w_s)}{w_s-b}
$$

### Ejercicio (b) 
\begin{enumerate}
\item[] \textit{How does an increase in $N_p$ affect unemployment? Explain intuitively why, even though unemployment takes the form of workers waiting for primary sector jobs, increasing the number of these jobs can increase unemployment.}
\end{enumerate}

Para determinar la forma en que un incremento del número de empleos primarios afecta al desempleo hacemos estática comparativa sobre el nivel de desempleo de equilibrio U con respecto a $N_p$
$$
\frac{\partial U}{\partial N_p}= \frac{w_p-w_s}{w_s-b}>0
$$
La derivada es positiva porque estamos asumiendo que $b < w_s < w_p$. Además, este resulyado implica que un aumento en el número de empleos en el sector primario incrementa el desempleo de equilibrio. Intuitivamente: más empleos primarios incrementan las probabilidades para las personas en este sector de conseguir empleo; sin embargo, este hecho motiva a más individuos a escoger el sector primario antes que el secundario; En consecuencia, muchos más lo prefieren, es mayor el aumento de personas que buscan empleo en el sector primario que el número de trabajadores de este sector que en desempleo aumenta.

### Ejercicio (c) 

\begin{enumerate}
\item[] \textit{What are the effects of an increase in the level of unemployment benefits$?$}
\end{enumerate}

Podemos encontrar el efecto haciendo estática comparativa sobre el nivel de desempleo de equilibrio U con respecto a b.
$$
\frac{\partial U}{\partial b}= \frac{N_p(w_p-w_s)}{(w_s-b)^2}>0
$$
Dado el supuesto $b < w_s < w_p$ lo anterior  indica que el desempleo aumenta si b sube. Intuitivamente: mayores beneficios al estar desempleado hacen el sector primario más atractivo;por lo que aumenta el incentivo a buscar empleo en este sector, dado que existe un número fijo de trabajos disponibles, más personas terminarán desempleadas.



\clearpage
# Ejercicios prácticos

```{r}
pacman::p_load(tidyverse,
               ggthemes,
               haven, readxl,
               kableExtra,
               cowplot, ggplot2, scales, viridis, latticeExtra,
               knitr, tinytex, reshape, lubridate, scales, reshape2)
```

## Ejercicio 2
**2. Estudie el mercado laboral en México siguiendo estos pasos:**


### (a) 

**Obtenga del INEGI una serie anual de los salarios (en términos reales) en México, calcule la serie de su tasa de cambio anual, calcule la volatilidad de dicha serie. (Serie 1).**


La obuvimos de [INEGI](https://www.inegi.org.mx/app/tabulados/?nc=100100083&idrt=300&opc=t)

Cambio porcentual y Volatilidad de Serie 1

```{r}
salarios <- read.csv(file = "Salarios.csv", sep = ",")

salarios <- salarios[,-c(3,4)]

View(salarios)

sal08 <- salarios[2:13,-1]
sal08 <- mean(sal08)
sal09 <- salarios[15:26,-1]
sal09 <- mean(sal09)
sal10 <- salarios[28:39,-1]
sal10 <- mean(sal10)
sal11 <- salarios[41:52,-1]
sal11 <- mean(sal11)
sal12 <- salarios[54:65,-1]
sal12 <- mean(sal12)
sal13 <- salarios[67:78,-1]
sal13 <- mean(sal13)
sal14 <- salarios[80:91,-1]
sal14 <- mean(sal14)
sal15 <- salarios[93:104,-1]
sal15 <- mean(sal15)
sal16 <- salarios[106:117,-1]
sal16 <- mean(sal16)
sal17 <- salarios[119:130,-1]
sal17 <- mean(sal17)
sal18 <- salarios[132:143,-1]
sal18 <- mean(sal18)
sal19 <- salarios[145:156,-1]
sal19 <- mean(sal19)
sal20 <- salarios[158:169,-1]
sal20 <- mean(sal20)
sal21 <- salarios[171:178,-1]
sal21 <- mean(sal21)


sal_anual_real <- c(sal08, sal09, sal10, sal11, sal12, sal13, sal14, sal15, sal16, sal17,
           sal18, sal19, sal20, sal21)

year <- c(2008:2021)

salr <- data.frame(year, sal_anual_real)

salr <- salr %>% mutate(Serie_1 = (sal_anual_real/lag(sal_anual_real)-1)*100)

options(knitr.kable.NA = "-")

knitr::kable(
  salr, booktabs = TRUE, format = 'latex', col.names = c("Año", "Remuneración Media Real (Índice)","Variación %"),
  caption = "Variación Porcentual de los Salarios Reales (2008 - 2021)"
)%>%
  kable_styling(latex_options = "HOLD_position",position="center")
```


```{r eval=TRUE, echo=FALSE}
#Volatilidad
Serie_1 <- salr$Serie_1
vol_s1 <- sd(Serie_1, na.rm = T)
```
La volatilidad de esta tasa de crecimiento, medido por la desviación estándar es de `r vol_s1`


### (b)
**Obtenga del INEGI una serie anual del empleo total en México, calcule la serie de su tasa de cambio anual, calcule la volatilidad de dicha serie. (Serie 2)**


La obtuvimos de INEGi, de Indicadores económicos de coyuntura > Población ocupada, subocupada y desocupada (resultados trimestrales de la ENOE, 15 años y más) > Series desestacionalizadas y tendencia-ciclo.

Cambio Porcentual y Volatilidad de Serie 2

```{r} 
# Cambio Porcentual

empleo <- read_excel("Empleo.xls",
                     sheet = 1) 

empleo$Periodos <- year(parse_date_time(empleo$Periodos, orders = "%Y/%q"))

empleo <- empleo %>% group_by(Periodos) %>% summarise(`PEA Ocupada`, PEA_Ocup_anualizado = mean(`PEA Ocupada`, na.rm=T), .groups = 'drop')

empleo <- empleo[!duplicated(empleo[c('PEA_Ocup_anualizado')]),]

empleo <- empleo %>% mutate(Serie_2 = (PEA_Ocup_anualizado/lag(PEA_Ocup_anualizado)-1)*100) 

empleo <- empleo[,c(1,3,4)]

empleo <- na.omit(empleo)

knitr::kable(
  empleo, booktabs = TRUE, format = 'latex', col.names = c("Año", "Población Ocupada","Variación %"),
  caption = "Variación Porcentual de la Población Ocupada (2006 - 2021)", longtable = F
)%>%
  kable_styling(latex_options = "HOLD_position",position="center")
```


```{r eval=TRUE, echo=FALSE}
# Volatilidad
Serie_2 <- empleo$Serie_2

vol_s2 <- sd(Serie_2, na.rm = T)

```
La volatilidad de esta tasa de crecimiento, medido por la desviación estándar es de `r vol_s2`

### (c)

**Obtenga del INEGI una serie anual del producto interno bruto en términos reales, calcule su tasa de cambio anual, calcule su volatilidad. (Serie 3)}**


Lo obtuvimos de INEGI, de Indicadores económicos de coyuntura > Producto interno bruto trimestral, base 2013 > Series desestacionalizadas y tendencia-ciclo > A precios de 2013 > Total > Serie desestacionalizada > Valores absolutos. Para que coincida con los demás datos anualizamos el PIB, que estaba en trimestres, esto con un promedio simple, siguiendo lo que menciona Jonathan Heath.

Cambio Porcentual y Volatilidad de Serie 3

```{r} 
#Cambio Porcentual

datos <- read_excel("PIB_K.xls",
                     sheet = 1) 

names(datos) = c('Periodo', 'Inversión', 'Indice K','PIB')

datos <- datos[-c(1:200),-c(2,3)]

datos$Periodo <- year(parse_date_time(datos$Periodo, orders = "%Y%q"))

datos <- na.omit(datos)
  
datos$PIB <- as.numeric(as.character(datos$PIB)) 

datos <- datos %>% group_by(Periodo) %>% summarise(PIB, PIB_an = mean(PIB), .groups = 'drop')

datos <- datos[!duplicated(datos[c('PIB_an')]),] 

datos <- datos[,-2]

datos_pib <- datos %>% mutate(Serie_3 = (PIB_an/lag(PIB_an)-1)*100) 

datos_pib <- na.omit(datos_pib)

knitr::kable(
  datos_pib, booktabs = TRUE, format = 'latex', col.names = c("Año", "Producto Interno Bruto","Variación %"),
  caption = "Variación Porcentual de los Salarios Reales (2008 - 2021)", longtable = F
)%>%
  kable_styling(latex_options = "HOLD_position",position="center")
```
Volatilidad

```{r eval=TRUE, echo=FALSE}
#Volatilidad
Serie_3 <- datos_pib$Serie_3
vol_s3 <- sd(Serie_3, na.rm = T)

```
La volatilidad de esta tasa de crecimiento, medido por la desviación estándar es de `r vol_s3`

  
### (d)
**Grafique las tres series de tasas de cambios de forma que se puedan comparar.**
  
```{r fig.cap='Comparación de Variación Porcentual entre Series\\label{graf1}', fig.pos = 'H'}
Series <- datos_pib[,c(1,3)]

year <- datos_pib$Periodo
year <- year[-c(1,2)]
Serie1 <- salr$Serie_1
Serie2 <- empleo$Serie_2
Serie2 <- Serie2[-c(1,2)]
Serie3 <- datos_pib$Serie_3
Serie3 <- Serie3[-c(1,2)]


Series <- data.frame(year, Serie1, Serie2, Serie3)

pacman::p_load(extrafont)

meltdf <- melt(Series,id="year")
gg <- ggplot(meltdf,aes(x=year,y=value,colour=variable,group=variable)) + geom_line() + 
  labs(title = "Comparación de Variación Porcentual entre Series", x="Año",y='Variación Porcentual', 
      colour = " ") + theme_bw() +  theme(text=element_text(size=12,  family="serif"))

plot(gg) 

```

### (e)
**Calcule la covarianza de la serie 1 con la 3 y de la 2 con la 3.**

La covarianza entre Serie 1 y Serie 3 es:
```{r eval=TRUE, echo=FALSE}
# cov(Serie1[-1], Serie3[-1])
```
\begin{center}
$Cov(Serie_1, Serie_3) =$ `r cov(Serie1[-1], Serie3[-1])`
\end{center}

La covarianza entre Serie 2 y Serie 3 es :

\begin{center}
$ Cov(Serie_2, Serie_3) = $ `r cov(Serie_2, Serie_3)`
\end{center}

  
```{r eval=TRUE, echo=FALSE}
# cov(Serie_2, Serie_3)
```

### (f) 
**Explique si sus resultados son o no consistentes con los hechos estilizados para EEUU que se discutieron en clase.**

El primer hecho estilizado es que el desempleo parece ser el mismo a lo largo de la historia. La tasa de desempleo no fue requerida en algún inciso del ejercicio, pero una [sencilla búsqueda en internet](https://www.proyectosmexico.gob.mx/por-que-invertir-en-mexico/mercado-potencial/sd_historico-tasa-de-desempleo-en-mexico/), puede confirmar este hecho estilizado. Históricamente, tasa de desempleo fluctúa alrededor de 3.5\%. 

El segundo hecho estilizado nos dice que el nivel de empleo fluctúa con el ciclo económico, pero los salarios parecen tener nada que ver con tal ciclo. Como puede observarse en la gráfica (y como bien lo enfatiza las respectivas varianzas), México cumple con este segundo hecho estilizado con respecto a el salario real. Además, puede observarse que los cambios en el mercado laboral sí fluctúan muy similar al ciclo económico.

\clearpage

## Ejercicio 3
**3. Contraste un modelo trivial de la determinación del salario con los datos siguiendo estos pasos:**


### (a)
**Obtenga una serie del PIB $Y_t$ de la economía.**


**Solución**

Lo obtuvimos de INEGI, de Indicadores económicos de coyuntura > Producto interno bruto trimestral, base 2013 > Series desestacionalizadas y tendencia-ciclo > A precios de 2013 > Total > Serie desestacionalizada > Valores absolutos, es el mismo utilizado en el ejercicio anterior, solo que para este lo dejaremos en trimestres y se obtendrá un indice del mismo con base 2013 para tener unidades homogéneas y facilitar el trabajo de los datos.
```{r} 
#Cambio Porcentual

datos <- read_excel("PIB_K.xls",
                     sheet = 1) 


names(datos) = c('Periodo', 'Inversión', 'Indice_K','PIB')

datos <- datos[-c(1:236),-2]
PIB <- datos[,-2]
PIB$Periodo <- quarter(parse_date_time(datos$Periodo, orders = "%Y%q"), with_year = TRUE)
PIB <- na.omit(PIB)
PIB$PIB <- as.numeric(as.character(PIB$PIB)) 
ano_base <- as.numeric(PIB[21,2])
PIB$Y <- ((PIB[,2]/ano_base)*100)

```
### (b)
**Obtenga una serie del capital $K_t$ de la economía ("Indice de Volumen físico acumulado")**

La obtuvimos de INEGI,Indicadores económicos de coyuntura > Inversión fija bruta, base 2013 > Series Originales > Índice de volumen físico acumulado > Total, como es una serie en meses sacamos el promedio para cada trismestre y que así coincida con el PIB.


```{r}
K <- datos[,-3]
K$Periodo <- quarter(parse_date_time(K$Periodo, orders = "%Y%m"), with_year = TRUE)
K$Indice_K <- as.numeric(as.character(K$Indice_K)) 
K <- K %>% group_by(Periodo) %>% summarise(Indice_K, K_q = mean(Indice_K), .groups = 'drop')
K <- K[!duplicated(K[c('K_q')]),]
K <- na.omit(K)
K <- K[,-2]
K <- K[-56,]
```

### (c)
**Obtenga una serie del empleo $L_t$ de la economía.**

Usaremos el mismo que en el inciso anterior, como nuestros datos son mensuales sacaremos el promedio para cada trimestre. Además al ser en valores absolutos esta información haremos lo mismo que en el inciso a) de este ejercicio, obtener un índice con base 2013 para facilitar el trabajo de los datos.

```{r}

empleo <- read_excel("Empleo.xls",
                     sheet = 1) 
empleo <- empleo[-c(1:12),]
empleo$Periodos <- quarter(parse_date_time(empleo$Periodos, orders = "%Y/%q"), with_year = TRUE)
empleo <- empleo[,c(1,5)]
ano_base2 <- as.numeric(empleo[21,2])
empleo$L <- ((empleo[,2]/ano_base2)*100)

```
En la siguiente figura se puede apreciar los cambios en el tiempo de las tres variables de los incisos a), b) y c).

```{r fig.cap='Producto, Capital y Trabajo (2008-2021)', fig.pos = 'H'}
datos_grafica1 <- data.frame(PIB$Periodo,PIB$Y, K$K_q, empleo$L)
names(datos_grafica1) = c('Periodo','Y','K','L')
mdatos_grafica1 <- melt(datos_grafica1, id.vars = "Periodo")
grafica1 <- ggplot(mdatos_grafica1, aes(x=Periodo, y=value ,colour=variable,group=variable))+geom_line() + 
  labs(title = "Producto, Capital y Trabajo (2008-2021)", x="Año",y='Porcentaje', 
      colour = " ") + theme_bw() +  theme(text=element_text(size=12,  family="serif"))
plot(grafica1)
```
### (d)
**Cree una serie de la productividad $A_t$ de la economía a partir de asumir una función de producción $Y_t=A_tF(K,L)$, con $F(K,L)=K^{0.3}L^{0.7}$.**

La calcularemos siguiendo el despeje de la función de producción tipo Cobb-Douglas, sustituyendo los valores de $Y_t$, $L_t$ y $K_t$ obtenidos en los incisos anterios de este mismo ejercicio.

$$
\text{Productivadad}=A_t=\frac{Y_t}{F(K,L)}=\frac{Y_t}{K^{0.3}L^{0.7}}
$$

```{r fig.cap='Productividad', fig.pos = 'H'}
productividad <- PIB[,1]
productividad$A <- as.numeric(unlist((PIB$Y/(((K$K_q)^(0.3))*((empleo$L)^(0.7))))))

grafica2 <- ggplot(productividad, aes(x=Periodo, y=A))+geom_line(colour = "orange") + 
  labs(title = "Productividad (2008-2021)", x="Año",y='Valor', 
      colour = " ") + theme_bw() +  theme(text=element_text(size=12,  family="serif"))
plot(grafica2)

```
\clearpage

### (e)
**Cree una serie contrafactual del salario que se debió de haber observado si el salario fuera el ingreso marginal del trabajo $A_tF_L(K_t,L_t)$.**

$$
w_t= \frac{\partial Y_t}{\partial L}= \frac{\partial A_tF_L(K_t,L_t)}{\partial L}= \frac{0.7A_tK^{0.3}}{L^{0.3}}
$$
```{r fig.cap='Salario Contrafactual', fig.pos = 'H'}
salario <- PIB[,1]
salario$w <- as.numeric(unlist((100)*(0.7)*(productividad$A)*((K$K_q)^(0.3))*((empleo$L)^(-0.3))))

grafica3 <- ggplot(salario, aes(x=Periodo, y=w))+geom_line(colour = "red") + 
  labs(title = "Salario contrafactual", x="Año",y='Valor', 
      colour = " ") + theme_bw() +  theme(text=element_text(size=12,  family="serif"))
plot(grafica3)

```

### (f) 
**Compare el salario observado con el salario contrafactual a la luz de los hechos estilizados y las teorías descritas en clase.**

Utilizaremos el mismo salario que usó en el ejercicio 2, ya era un índice del salario medio real con base en el 2013, de modo que solo obtendremos su promedio trimestral para que coincida con el resto de la información.

```{r fig.cap='Comparación de los salarios', fig.pos = 'H'}
salarios <- read.csv(file = "Salarios.csv", sep = ",")

salarios <- salarios[,-c(3,4)]

fecha <- datos[-c(166:173),1]

sal08 <- salarios[2:13,-1]
sal09 <- salarios[15:26,-1]
sal10 <- salarios[28:39,-1]
sal11 <- salarios[41:52,-1]
sal12 <- salarios[54:65,-1]
sal13 <- salarios[67:78,-1]
sal14 <- salarios[80:91,-1]
sal15 <- salarios[93:104,-1]
sal16 <- salarios[106:117,-1]
sal17 <- salarios[119:130,-1]
sal18 <- salarios[132:143,-1]
sal19 <- salarios[145:156,-1]
sal20 <- salarios[158:169,-1]
sal21 <- salarios[171:179,-1]

sal_mensual <- c(sal08, sal09, sal10, sal11, sal12, sal13, sal14, sal15, sal16, sal17,
           sal18, sal19, sal20, sal21)
sal <- data.frame(fecha, sal_mensual)
sal$Periodo <- quarter(parse_date_time(sal$Periodo, orders = "%Y/%m"), with_year = TRUE)
sal <- sal %>% group_by(Periodo) %>% summarise(sal_mensual, sal_q = mean(sal_mensual), .groups = 'drop')
sal <- sal[!duplicated(sal[c('sal_q')]),]
datos_grafica4 <- data.frame(PIB$Periodo,salario$w, sal$sal_q)
names(datos_grafica4) <- c("Periodo", "Salario_contrafactual", "Salario_observado")
mdatos_grafica4 <- melt(datos_grafica4, id.vars = "Periodo")
grafica4 <- ggplot(mdatos_grafica4, aes(x=Periodo, y=value ,colour=variable,group=variable))+geom_line() + 
  labs(title = "Comparación de los salarios", x="Año",y='Porcentaje', 
      colour = " ") + theme_bw() +  theme(text=element_text(size=12,  family="serif"))
plot(grafica4)
```
Cambio Porcentual y Volatilidad de Serie 3
Es sencillo que notemos que el salario calculado (contrafactual) es mucho más bajo que el salario observado en el mismo periodo, esta diferencia la podemos explicar dentro de los temas vistos en clase. Asumimos a la hora de calcular el salario contrafacutal una función de producción Cobb-Douglas con parámetros dados, además de considerar que el mercado de laboral sería walrasiano, es decir, que la productividad marginal del trabajo equivale al salario ($\frac{ \partial Y_t}{ \partial L_t}=w$).

De entrada podemos atribuir esta diferencia a que existen salarios de eficiencia, es decir las empresas ven una mejora en sus beneficios si se paga más por el esfuerzo extra. Esta explicación nos hace sentido, ya que, en México gran parte de la población vive en condiciones precarias, lo cual propicia que se esfuercen más cuando su salario es mayor que la productividad marginal, en el contexto Shapiro-Stiglitz la utilidad de esforzarse y estar empleado es mucho mayor a la desutilidad del trabajo, y volviendo a la precariedad un aumento al salario significa una mejora en la calidad de vida significativa.

Otras posibles explicaciones están relacionadas con el tema de la informalidad(tratado en clase), en México existen dos mercados de trabajo con distintas condiciones: uno formal y uno informal.
La primera explicación usando estos dos mercados laborales es que en el salario observado llega a faltar información del mercado laboral informal, lo cual genera discrepancia entre los datos calculados y los observados.
Otra explicación que podemos obtener es que si asumimos que el mercado laboral informal es walrasiano (que el salario de este coincide al contrafactual que calculamos) encontraremos que la explicación de los salarios de eficiencia reaparece. Las empresas formales pagan más porque buscan tener a los mejores trabajadores, ya que al ser formales también tienen mayores costos (pago de impuestos, indemnizaciones, etc... ), entonces podemos esperar que las empresas quieran pagar un mejor salario para compensar o no tener que pagar estos costos adicionales, como los que provienen de indemnizar trabajadores despedidos, así que no solo se pueden pagar salarios de eficiencia para tener una mejor producción sino para reducir otros costos.
Otra explicación ligada a la informalidad la encontramos en las rigideces de los contratos, por regulaciones legales, una vez fijados los salarios estos no pueden disminuir o bajar, y existen topes como el salario mínimo que se puede llegar a encontrar por encima del nivel de la productividad marginal del trabajo.
Las explicaciones que dimos referentes a la informalidad no son excluyentes entre si, sería muy factible que se dieran ambas situaciones, incluso podríamos sumar que si el tamaño de el mercado formal es menor en comparación a la oferta de mano, el salario de eficiencia va a ser menor a que si todo el mercado laboral mexicano fuera formal.

\clearpage

## Ejercicio 4
**4. Desarrolle su intuición cuantitativa sobre la informalidad laboral en México siguiendo estos pasos**


### (a) 

**Obtenga la “Matriz Hussmans” para México, del INEGI, para algún trimestre de 2019.**

La Matriz Hussmanns (mostrada en la siguiente página) es un esquema integrador que implica un algoritmo, en el cual el enfoque de unidad económica aplica a las modalidades de trabajo independiente (i.e. empleadores y trabajadores por cuenta propia), mientras que el enfoque laboral aplica a modalidades de trabajo dependiente, como es el trabajo asalariado.

Este esquema contempla ambas dimensiones de la informalidad:

1. La primera definición alude al tipo o naturaleza de la Unidad Económica: cuando ésta produce bienes y servicios operando a partir de los recursos del hogar y sin llevar los registros contables básicos, se habla de Sector Informal y, por tanto, de empleo vinculado a tal sector.

2. La segunda definición es una perspectiva laboral, y abarca a todo trabajo que se esté realizando sin contar con el amparo de un marco institucional o legal, sin importar que la unidad económica esté registrada y constituida formalmente o no. De esta manera, se habla de "empleo informal".

Para realizar este ejercicio, se obtuvo de la página del INEGI el documento "enoe_informalidad_15ymas_2019", el cual cuenta con las matrices de los cuatro trimestres e información detallada sobre la informalidad. En particular, se utilizará el último trimestre del 2019.

\newpage
\begin{landscape}
```{r}
matriz_hus <- read_excel("matriz.xlsx", sheet = 2)
names(matriz_hus) <- c("Tipo de unidad \n económica empleadora", "Informal", "Formal",
                       "Informal", "Formal","Informal", "Formal","Informal", "Formal","Informal", "Formal",
                       "Informal", "Formal", "Total")

knitr::kable(matriz_hus, booktabs = TRUE, format = 'latex', caption = "Matriz Hussmanns para México, 4º Trimestre de 2019", longtable = F)%>%
    add_header_above(c(" ", "Asalariados" = 2, "Con percepciones \n no salariales" = 2,
                       "Empleadores" = 2, "Trabajadores por \n cuenta propia" = 2,
                       "Trabajadores \n no remunerados" = 2, "Subtotal por perspectiva de la \n unidad económica y/o laboral" = 2))%>%
  add_header_above(c(" ", "Posición en la ocupación y condición de informalidad" = 12), bold = T, italic = T) %>%
  kable_styling(latex_options = "scale_down", "center")


```
\end{landscape}

### (b) 
**A partir de la tabla, averigüe qué proporción de los trabajadores trabaja en el “sector informal” de la economía.**

En la primera fila de la matriz se encuentra la información sobre el sector laboral, en donde el total es la suma de varios componentes de un desglose importante, personas ocupadas que están en el sector informal según ciertas condiciones:

 + Trabajadores subordinados y remunerados
 + Empleadores
 + Trabajadores por cuenta propia
 + Trabajadores no remunerados

Esta suma asciende a 15,172,271 personas en el cuarto trimestre del 2019, el cual representa el 27.41% de la población ocupada.

### (c)
**A partir de la tabla, averigüe qué proporción de los trabajadores del sector formal son informales.**

Como se mencionó, puede hablarse de una situación de "empleo informal", la cual tiene que ver con empleados en el sector formal que no cuentan con prestaciones básicas ni acceso a instituciones de salud. En el cuadro 5, el número de empleados en estas condiciones asciende a 15,869,947. Esta cifra es espectacular, puesto que se ubica por encima del propio sector informal.

### (d)

**Averigüe con datos del INEGI cuáles son las industrias formales con mayor proporción de trabajadores informales y los estados de la república con mayor proporción de trabajadores informales.**

Del documento "Nacional_IE_ForInf_Total_419" extraemos la información concerniente a la informalidad por sector económico, el cual incluye datos sobre los sectores primario, secundario y terciario.

```{r fig.pos= 'H'}
sectores <- read_excel("Nacional_IE_ForInf_Total_419.xlsx", sheet = 2)

names(sectores) <- c("Indicador","Población Ocupada", "Ocupación Formal", "Subtotal", "Sector Informal", "Subtotal", "Ambito no agropecuario", "Ambito agropecuario")

sectores_tab <- sectores[-c(2,4,8),]

View(sectores)

knitr::kable(sectores_tab, booktabs = TRUE, format = 'latex', caption = "Informalidad Laboral por Sectores", longtable = F)%>%
    add_header_above(c(" ", " ", " ", " ", " ", "Fuera del Sector Informal" = 3))%>%
  add_header_above(c(" "," ", " ", "Ocupación Informal" = 5)) %>%
  add_header_above(c(" ", "Estimaciones" = 7), bold = T)%>%
  kable_styling(latex_options = c("HOLD_position", "scale_down"), "center") %>% pack_rows("Primario", 2, 2) %>% pack_rows("Secundario", 3, 5) %>%
    pack_rows("Terciario", 6, 12) 

```
\clearpage

Nótese que el sector terciario es en donde se presenta más informalidad, con una proporción de alrededor del 65\% del total. Por otro lado, el sector secundario sólo representa el 35\% del sector informal. 

Dentro del apartado "Fuera del Sector Informal", el sector primario asciende a 5,881,455 personas ocupadas que, a pesar de no considerarse del sector informal, se encuentran en condición de "Ocupación Informal", por lo que puede inferirse que carecen de acceso a instituciones de salud y no tienen el amparo del marco legal. En el caso del sector secundario, en este triemstre había 1,426,732 personas ocupadas en la informalidad, consideradas "fuera del sector informal". Y para el sector terciario, son 8,280,701 de personas en esta situación.

Resulta ilustrativo representar estas cifras por medio de gráficas. En cuanto al sector primario, dado que su desglose consiste en un elemento, no resulta muy útil. Sin embargo, para los sectores secundario y terciario existen más detalles:

```{r fig.pos = 'H', fig.width=5, fig.height=5, fig.cap= "Empleo Informal en Sector Formal"}
sec <- data.frame(ramo1 =c("Industria ext./electricidad", "Industria manufacturera", "Construcción") ,
                   cant = c(31961,1131086,263685))
                 
terc <- data.frame(ramo2 = c("Comercio", "Restaurantes", "Transportes y comunicaciones", "Servicios profesionales", "Servicios sociales", "Servicios diversos", "Gobierno y organismos intls."),
                  cant2 = c(1950962, 963599, 424041, 640510, 735899, 3120229, 445461))


sec1 <- ggplot(sec, aes(x=ramo1, y=cant)) + geom_bar(stat='identity', width = 0.3, fill = "orange") + scale_y_continuous(labels = comma) + scale_x_discrete(guide = guide_axis(angle = 90)) +  labs(title = "Sector Secundario", x = " ", y= " ") + theme_bw() + theme(text=element_text(size=12,  family="serif"))

terc1 <- ggplot(terc, aes(x=ramo2, y=cant2)) + geom_bar(stat='identity', width = 0.3, fill = "olivedrab3") + scale_y_continuous(labels = comma) + scale_x_discrete(guide = guide_axis(angle = 90))  + theme_bw() + labs(title = "Sector Terciario", x = " ", y= " ") + theme(text=element_text(size=12,  family="serif"))

plot_grid(sec1, terc1)
```
En este par de gráficas se puede observar que, dentro del sector secundario, la industria que menos presenta niveles de empleo informal es el de la extracción y electricidad, mientras que la industria manufacturera emplea 1,300,000 de personas en informalmente.

Por otra parte, el rubro de "Servicios diversos" es el que presenta más empleo informal, ascendiendo a 3,120,000 empleos de este tipo. El menor nivel se encuentra en servicios de gobierno y organismos internacionales. Pese a ser una cifra pequeña, esto último llama la atención, pues se esperaría que el estado, como ente empleador, se apegara al marco legal y dotara de prestaciones a todos sus trabajadores.


El desglose de la informalidad por entidad federativa se ilustra por medio de la siguiente gráfica:

```{r, fig.height= 4.5, fig.pos='H', fig.cap="Informalidad por Entidad Federativa"}

compara <- read_excel("ComparativoENOE.xlsx")


comparaent <- compara[-1,] %>% arrange(desc(Informalidad))


ggplot(comparaent, aes(x = reorder(Entidad, -Informalidad), y = Informalidad)) + geom_bar(stat='identity', fill = 'purple') +
  scale_x_discrete(guide = guide_axis(angle = 90)) + theme_bw() + labs(title = "Informalidad por Entidad Federativa (Trim. IV, 2019)", x = " ", y = "Número de personas en \n condición de informalidad") + theme(text=element_text(size=12,  family="serif")) + scale_y_continuous(labels = comma)

```

Naturalmente, aquellos estados en donde haya mayor población, puede esperarse que exista mayor informalidad. Entre los primeros tres, el Estado de México se encuentra a la delantera, con casi 2,500,000 de personas en condición de informalidad. Luego la gráfica disminuye drásticamente, donde le Ciudad de México se encuentra en niveles de alrededor de 1,300,000 en tal situación. Después, el estado con mayor informalidad es Veracruz, con aproximadamente 900,000 personas informales.

En cambio, los estados que presentan menor informalidad son Campeche, Baja California (Sur) y Colima, en donde este último no llega ni a 70,000 personas en esta condición.

### (e)

**Obtenga una medida de salario por industria y grafique el nivel de informalidad contra el salario.**

Los datos sobre el salario por sector pueden consultarse a través del portal de la Secretaría del Trabajo y Previsión Social, en el apartado de [estadísticas](http://stps.gob.mx/gobmx/estadisticas/). Aquí, puede ingresarse al polígono de salarios y luego seleccionar, en el apartado "Salario diario asociado a trabajadores asegurados", el documento "Sector de Actividad del 2000 a la fecha". Si el lector está interesado en mayor visualización de estos datos, el IMSS cuenta con un [sitio](https://public.tableau.com/app/profile/imss.cpe/viz/Histrico_4/Empleo_h) para tal propósito.

```{r fig.pos = 'H'}
salsec <- read_excel("302_0121.xls", sheet = 2)

View(salsec)
salsec <- salsec[-c(1,6),]

names(salsec) <- c("Rubro", "Octubre","Noviembre","Diciembre", "Promedio") 

knitr::kable(salsec, booktabs = TRUE, format = 'latex', caption = "Salario (pesos por día) por Sector de Actividad Econímica, 4T 2019",longtable = F
)%>%
  kable_styling(latex_options = "HOLD_position", "center") 

```

Como podrá darse cuenta el lector, este cuadro no contempla todos los rubros que se mostraron en el Cuadro 5. Resulta útil e interesante utilizar otra fuente de datos de una institución igualmente importante que el INEGI. Sin embargo, se prescindirá del rubro de suministro de agua potable y electricidad, de manera que podamos conciliar este conjunto de datos con los proporcionados del INEGI. Para la siguiente gráfica se utilizará la proporción de cada rubro con respecto al total de la informalidad que estos rubros representan. 

```{r, fig.pos='H', fig.cap = "Relación entre Salario e Informalidad"}

plotsal <- mutate(salsec, infm = c(5881455,51391,3371447,3277344,6436881,1501398,1190268,872624))
plotsal <- mutate(plotsal, propr = infm/sum(infm))
View(plotsal)

ggplot(plotsal, aes(x = propr, Promedio)) + geom_point(aes(colour = Rubro), size=2) + labs(title = "Salario diario vs Informalidad \npor Sector 4T 2019", x="Proporción de Informalidad",y="Pesos por día") + theme_bw() +  theme(text=element_text(size=12,  family="serif")) 

```

### (f)  

**Enuncie algunas conclusiones tentativas sobre los resultados que obtuvo, relacionándolas con los modelos discutidos en clase.**

En un primer acercamiento, esta gráfica sugiere una relación clara entre el salario y el nivel de informalidad por sector: a mayor nivel de informalidad, menor salario diario. Como se discutió en clase, esto puede deberse a distintas razones. Entre ellas, destaca el hecho en que el trabajo informal suele ser menos productivo que el formal, por lo que el pago que reciben estos trabajadores es menor cuando la informalidad tiene mucha presencia. 

Además, contar con un alto porcentje de la informalidad respecto al total de población ocupada tiene otros efectos perjudiciales, como el peso de la tasa impositiva que recae en el sector formal -reduciéndolo en tamaño y en productividad-. En consecuencia, los ingresos gubernamentales también se ven afectados y el margen de acción para la política fiscal (y social) se reduce.



## Ejercicio 5
**5. Practique trabajar con datos laborales de México siguiendo estos pasos:**

### (a) 
**Descargue los micro-datos de la ENOE (también del INEGI), correspondientes a los cuatro trimestres de 2019.**

De acuerdo con el Instituto Nacional de Estadística y Geografía (INEGI), la Encuensta Nacional de Ocupación y Empleo [(ENOE)](http://internet.contenidos.inegi.org.mx/contenidos/Productos/prod_serv/contenidos/espanol/bvinegi/productos/metodologias/est/702825000987.pdf) es "un procedimiento estadístico de recolección de iformación en una muestra representativa de viviendas, cuyo objetivo es cuantificar y caracterizar a la población en edad de trabajar que participa en la generación de bienes y servicios económicos."

Los datos para este ejercicio se recuperaron del [INEGI](https://www.inegi.org.mx/programas/enoe/15ymas/#Microdatos) en formato csv.

### (b) 
**Calcule el desempleo en cada trimestre, explicando cómo lo calculó.**

```{r}

t119 <- read_csv("sdemt119.csv")
t219 <- read_csv("sdemt219.csv")

t319 <- read_csv("sdemt319.csv")
names(t319) <- tolower(names(t319))

t419 <- read_csv("sdemt419.csv")
names(t419) <- tolower(names(t419))

#Población Econóicamente Activa 
PEA1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase1 == 1) %>% summarise(sum(fac)))

PEA2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase1 == 1) %>% summarise(sum(fac)))

PEA3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase1 == 1) %>% summarise(sum(fac)))

PEA4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase1 == 1) %>% summarise(sum(fac)))

#Población Ocupada
PO1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 1) %>% summarise(sum(fac)))

PO2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 1) %>% summarise(sum(fac)))

PO3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 1) %>% summarise(sum(fac)))

PO4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 1) %>% summarise(sum(fac)))


#Población Desocupada
PD1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 2) %>% summarise(sum(fac)))

PD2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 2) %>% summarise(sum(fac)))

PD3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 2) %>% summarise(sum(fac)))

PD4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 2) %>% summarise(sum(fac)))

#Tasa de desempleo

U_1 <- (PD1/PEA1)*100
U_2 <- (PD2/PEA2)*100
U_3 <- (PD3/PEA3)*100
U_4 <- (PD4/PEA4)*100

```
La tasa de desempleo está dada por la siguiente expresión 
$$\text{Tasa de desempleo} = \frac{\text{Población Desocupada}}{\text{Población Económicamente Activa}}*100$$

```{r, fig.cap="Tasa de Desempleo, 2019"}
unemp <- data.frame(Desempleo = c(U_1,U_2,U_3,U_4), 
                    row.names = c('Trimestre I','Trimestre II','Trimestre III','Trimestre IV'))
knitr::kable(unemp, booktabs = TRUE, format = 'latex', longtable = F
)%>%
  kable_styling(latex_options = "hold_position", "center")

unemp_ <- data.frame(Trimestre = c(' I',' II',' III',' IV'),
                     desmp = c(U_1,U_2,U_3,U_4))

g1 <- ggplot(unemp_, aes(Trimestre,desmp)) + geom_bar(stat = "identity", fill = "darkolivegreen2", color = "black", width = 0.6) + theme_bw() + labs(title = "Tasa de Desempleo 2019", xlab = " Trimestre ", y="Porcentaje") +  theme(text=element_text(size=12,  family="serif"))

g1

```

### (c)
**Calcule el subempleo en cada trimestre, explicando cómo lo calculó.**
El subempleo refiere a la condición de aquellas personas que tienen trabajo pero que no laboran todas las horas que quieren por cuestiones del mercado laboral. La fórmula está dada por: 
$$
\text{Tasa de Subocupación} = \frac{\text{Población Subocupada}}{\text{Población Ocupada}}*100
$$

```{r fig.cap="Tasa de Subocupación, 2019"}
#Población Subocupada

Sub1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, sub_o==1) %>% summarise(sum(fac)))

Sub2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, sub_o==1) %>% summarise(sum(fac)))

Sub3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, sub_o==1) %>% summarise(sum(fac)))

Sub4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, sub_o==1) %>% summarise(sum(fac)))

#Tasa de Subocupación

Tsub_1 <- (Sub1/PO1)*100
Tsub_2 <- (Sub2/PO2)*100
Tsub_3 <- (Sub3/PO3)*100
Tsub_4 <- (Sub4/PO4)*100

suboc <- data.frame(Subempleo = c(Tsub_1, Tsub_2, Tsub_3, Tsub_4), 
                    row.names = c('Trimestre I','Trimestre II','Trimestre III','Trimestre IV'))
knitr::kable(suboc, booktabs = TRUE, format = 'latex', longtable = F
)%>%
  kable_styling(latex_options = "hold_position", "center")

suboc_ <- data.frame(Trimestre = c(' I',' II',' III',' IV'),
                     subOC = c(Tsub_1, Tsub_2, Tsub_3, Tsub_4))

g2 <- ggplot(suboc_, aes(Trimestre,subOC)) + geom_bar(stat = "identity", fill = "darkorange2", color = "black", width = 0.6) + theme_bw() + labs(title = "Tasa de Subempleo 2019", xlab = " Trimestre ", y="Porcentaje") +  theme(text=element_text(size=12,  family="serif"))

g2


```



### (d)

**Calcule la fracción de trabajadores fuera de la fuerza laboral, pero disponibles para trabajar, en cada trimestre, explicando cómo lo calculó.**

La Población Disponible es un elemento de la Población No Económicamente Activa (PNEA), y representa a aquellas personas que, por alguna razón, no están en búsqueda activa de empleo, pero que si se les presentara la oportunidad de trabajar la tomarían. Esto puede deberse a que, después de cierto tiempo de búsqueda, la persona deja de buscar por resignación.

Llamaremos Tasa de Disponibilidad a la fracción referida en el enunciado del problema, la cual está dada por la siguiente expresión:

$$
\text{Tasa de Disponibilidad} = \frac{\text{Población Disponible}}{\text{PNEA}}*100
$$

La PNEA es simplemente la suma de la Población Disponible y la No Disponible.

Así, tenemos la siguiente tabla que resume esta tasa en los trimestres del 2019:

```{r fig.cap="Tasa de Disponibilidad, 2019"}
#Población Disponible
disp1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 3, clase1==2) %>% summarise(sum(fac)))
disp2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 3, clase1==2) %>% summarise(sum(fac)))
disp3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 3, clase1==2) %>% summarise(sum(fac)))
disp4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 3, clase1==2) %>% summarise(sum(fac)))
#Población No Disponible
nd1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, clase2 == 4, clase1==2) %>% summarise(sum(fac)))
nd2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 4, clase1==2) %>% summarise(sum(fac)))
nd3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 4, clase1==2) %>% summarise(sum(fac)))
nd4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  clase2 == 4, clase1==2) %>% summarise(sum(fac)))
#La Población No Económicamente Activa está tada por Pob. Disponible + Pob. No Disponible.
#Por lo tanto, la fracción de trabajadores disponibles está dada por Pob. Disponible / (Pob. Disponible + Pob. No Disponible)
Td1 <- disp1/(disp1 + nd1)*100
Td2 <- disp2/(disp2 + nd2)*100
Td3 <- disp3/(disp3 + nd3)*100
Td4 <- disp4/(disp4 + nd4)*100
disp <- data.frame(Disponibilidad = c(Td1, Td2, Td3, Td4), 
                    row.names = c('Trimestre I','Trimestre II','Trimestre III','Trimestre IV'))
knitr::kable(disp, booktabs = TRUE, format = 'latex', longtable = F, caption = "Tasas de disponibilidad 2019"
)%>%
  kable_styling(latex_options = "hold_position", "center")
disp_ <- data.frame(Trimestre = c(' I',' II',' III',' IV'),
                     Dispt = c(Td1, Td2, Td3, Td4))
g3 <- ggplot(disp_, aes(Trimestre,Dispt)) + geom_bar(stat = "identity", fill = "lightblue", color = "black", width = 0.6) + theme_bw() + labs(title = "Tasa de Disponibilidad 2019", xlab = " Trimestre ", y="Porcentaje") +  theme(text=element_text(size=12,  family="serif"))
g3
```

### (e)

**Es muy importante que desarrolle un entendimiento de datos tipo ``panel rotativo'' como los de la ENOE. Para ello, calcule, utilizando a los individuos que aparecen en más de uno de los trimestres, la fracción de trabajadores que pasan del empleo al desempleo y del desempleo al empleo en cada trimestre y la suma de estas dos variables.**

Para este ejercicio generamos una id para cada persona en la ENOE, esto consiste en tomar ciertos identificadores como las etiquetas ("ent" ,"con", "v_sel", "n_hog", "h_mud", "n_ren","r_def", "c_res") y volverlas un código identificador, después hicimos un merge para poder encontrar a las personas que aparecen en los 4 trimestres y poder analizar la información.
```{r include=FALSE}

t119$trim <-1
t219$trim <-2
t319$trim <-3
t419$trim <-4
  
names1 <- c("ent" ,"con", "v_sel", "n_hog", "h_mud", "n_ren","r_def", "c_res")
t119[,names1] <- lapply(t119[,names1] , as.character)
str(t119)
  
names2 <- c('ent' ,'con', "v_sel", "n_hog", "h_mud", "n_ren","r_def", "c_res")
t219[,names2] <- lapply(t219[,names2] , as.character)
str(t219)
  
names3 <- c('ent' ,'con', "v_sel", "n_hog", "h_mud", "n_ren","r_def", "c_res")
t319[,names3] <- lapply(t319[,names3] , as.character)
str(t319)
  
names4 <- c('ent' ,'con', "v_sel", "n_hog", "h_mud", "n_ren","r_def", "c_res")
t419[,names4] <- lapply(t419[,names4] , as.character)
str(t419)
  
  
#Creamos el id y verificamos que cada trimestre no tenga duplicados
t119$id <- base::paste(t119$ent, t119$con, t119$v_sel,
                           t119$n_hog, t119$h_mud, t119$n_ren, sep = "-")
anyDuplicated(t119$id)

t219$id <- base::paste(t219$ent, t219$con, t219$v_sel,
                           t219$n_hog, t219$h_mud, t219$n_ren, sep = "-")
anyDuplicated(t219$id)

t319$id <- base::paste(t319$ent, t319$con, t319$v_sel,
                           t319$n_hog, t319$h_mud, t319$n_ren, sep = "-")
anyDuplicated(t319$id)
t419$id <- base::paste(t419$ent, t419$con, t419$v_sel,
                           t419$n_hog, t419$h_mud, t419$n_ren, sep = "-")
anyDuplicated(t419$id)
  

```

```{r}
trim_12 <-  merge(t119, t219, by = "id") %>% 
   select(id,clase1.x, clase1.y, clase2.x, clase2.y, fac.x, fac.y)
   
tabla_12 <- as.data.frame(trim_12 %>%  
  group_by(clase2.x, clase2.y) %>% 
   tally(wt = fac.x) %>%
   spread(clase2.y,n) %>% replace(is.na(.),0))

tabla_12 <- tabla_12[,-1]
rownames(tabla_12) <- c("No aplica","Población ocupada","Población desocupada","Disponibles", "No disponibles")
colnames(tabla_12) <- c("No aplica","Población ocupada","Población desocupada","Disponibles", "No disponibles")

knitr::kable(tabla_12, booktabs = TRUE, format = 'latex', longtable = F, caption = "Transición entre trimestre 1 y 2"
)%>%
  kable_styling(latex_options = "hold_position", "center")    

```

```{r}
trim_23 <-  merge(t219, t319, by = "id") %>% 
   select(id,clase1.x, clase1.y, clase2.x, clase2.y, fac.x, fac.y)
   
tabla_23 <- as.data.frame(trim_23 %>%  
  group_by(clase2.x, clase2.y) %>% 
   tally(wt = fac.x) %>%
   spread(clase2.y,n) %>% replace(is.na(.),0))

tabla_23 <- tabla_23[,-1]
rownames(tabla_23) <- c("No aplica","Población ocupada","Población desocupada","Disponibles", "No disponibles")
colnames(tabla_23) <- c("No aplica","Población ocupada","Población desocupada","Disponibles", "No disponibles")

knitr::kable(tabla_23, booktabs = TRUE, format = 'latex', longtable = F, caption = "Transición entre trimestre 2 y 3"
)%>%
  kable_styling(latex_options = "hold_position", "center")    

```

```{r}
trim_34 <-  merge(t319, t419, by = "id") %>% 
   select(id,clase1.x, clase1.y, clase2.x, clase2.y, fac.x, fac.y)
   
tabla_34 <- as.data.frame(trim_34 %>%  
  group_by(clase2.x, clase2.y) %>% 
   tally(wt = fac.x) %>%
   spread(clase2.y,n) %>% replace(is.na(.),0))

tabla_34 <- tabla_34[,-1]
rownames(tabla_34) <- c("No aplica","Población ocupada","Población desocupada","Disponibles", "No disponibles")
colnames(tabla_34) <- c("No aplica","Población ocupada","Población desocupada","Disponibles", "No disponibles")

knitr::kable(tabla_34, booktabs = TRUE, format = 'latex', longtable = F, caption = "Transición entre trimestre 3 y 4"
)%>%
  kable_styling(latex_options = "hold_position", "center")    

```
Con las matrices anteriores podemos obtener la información que nos interesa, las filas corresponden al periodo 
$t$ y las columnas al periodo $t+1$:
\begin{enumerate}
\item[] \textit{-Perdieron su empleo:Personsas que estaban empleadas en el periodo $t$ y desempleadas en el $t+1$, se puede obtener de [3,2]}
\item[]\textit{-Encontraron empleo:Personas que estaban desempleadas en el periodo $t$ y empleadas en el $t+1$, se encuentra en [2,3]}
\end{enumerate}

```{r}
tt_12 <- c(tabla_12[3,2],tabla_12[2,3])
tt_23 <- c(tabla_23[3,2],tabla_23[2,3])
tt_34 <- c(tabla_34[3,2],tabla_34[2,3])

trans_trim <- data.frame(tt_12,tt_23,tt_34)
trans_trim["Suma",] <- colSums(trans_trim)
names(trans_trim) <- c( "Trimestre 1-2", "Trimestre 2-3", "Trimestre 3-4")
rownames(trans_trim) <- c("Perideron empleo","Encontraron empleo", "Suma")

knitr::kable(trans_trim, booktabs = TRUE, format = 'latex', longtable = F, caption = "Transición trimestral"
)%>%
  kable_styling(latex_options = "hold_position", "center")    

```
Con la tabla anterior podemos hacer algo muy interesante,que consiste en calcular la tasa de creación de empleos y de destrucción de empleos, solo tenemos que usar la PEA obtenida en el inicios a) de este ejercicio y la transición entre trimestres:
$$
Tasa \; de \; creación \; de \; empleo = \frac{Encontraron \; empleo_{t,t+1}}{PEA_{t+1}}
$$

$$
Tasa \; de \; destrucción \; de \; empleo = \frac{Perdieron \; empleo_{t,t+1}}{PEA_{t+1}}
$$

```{r}
t_12 <- c(((tabla_12[2,3] / PEA2)*100), ((tabla_12[3,2] / PEA2)*100))
t_23 <- c(((tabla_23[2,3] / PEA3)*100), ((tabla_23[3,2] / PEA3)*100))
t_34 <- c(((tabla_34[2,3] / PEA4)*100), ((tabla_34[3,2] / PEA4)*100))

rates <- data.frame(t_12,t_23,t_34)
names(rates) <- c( "Trimestre 1-2", "Trimestre 2-3", "Trimestre 3-4")
rownames(rates) <- c("Tasa de creación de empleo","Tasa de destrucción de empleo")

knitr::kable(rates, booktabs = TRUE, format = 'latex', longtable = F, caption = "Tasas"
)%>%
  kable_styling(latex_options = "hold_position", "center")    

```
Esta última tabla nos muestra que durante todo el 2019 se destruyeron más puestos de trabajo de los que se crearon. Durante dicho periodo hubo una contracción del empleo que coincide con la información que obtuvimos en el ejercicio 3.
Podemos ver que el producto, el capital y el empleo se contraen en 2019, pero la caída en el salario observado del ejercicio dos refuerza las posibles explicaciones de salarios de eficiencia y de rigideces por contratos laborales, Sufre una caída el salario solo que no es tan dramática ( naturaleza moderadamente pro cíclica) y se produce despues del 2019, lo cual puede apuntar a que los salarios fijados por contratos retrasaron dicha caída. También podemos pensar que no caen tan drasticamente por la existencia de salarios de eficiencia y regulaciones legales.
Sumado a lo anterior podemos pensar en explicaciones del mercado laboral informal, que si suponemos se comportó como el salario contrafactual calculado en el ejercicio 3, entonces sí vio una caída más dramática.
Otra explicación de porque el salario pudo no haber caído tanto en los datos observados podríamos llegar a encontrarla en los fenómenos de insiders-outsiders, donde los que se quedaron negociaron caídas de los salarios menos dramáticas.

### (f)
**Calcule qué fracción de los trabajadores trabaja en empresas chicas, medianas y grandes.**

Definamos el total de personas que trabajan en este tipo de empresas, sin considerar micronegocios o personas que laboran en el sector público, como la suma: chicas + medianas + grandes. Así, las tasas (fracciones) estarán dadas por:

$$
\text{Tasa}_{it} = \frac{\text{Tamaño}_{it}}{\text{Total}_t}*100 ,
$$
en donde $i$ denota el tamaño de la empresa y $t$ el trimestre.

Presentamos también los valores absolutos.
```{r fig.cap="Trabajadores por Tamaño de Empresa, 2019"}
#Empleados en establecimientos pequeños
peq1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==4 ) %>% summarise(sum(fac)))
peq2<- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==4 ) %>% summarise(sum(fac)))
peq3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==4) %>% summarise(sum(fac)))
peq4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==4) %>% summarise(sum(fac)))
#Empleados en establecimientos medianos
med1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==5) %>% summarise(sum(fac)))
med2<- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==5) %>% summarise(sum(fac)))
med3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==5) %>% summarise(sum(fac)))
med4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==5) %>% summarise(sum(fac)))
#Empleados en establecimientos grandes
gra1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==6) %>% summarise(sum(fac)))
gra2<- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==6) %>% summarise(sum(fac)))
gra3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==6) %>% summarise(sum(fac)))
gra4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, pos_ocu==1, ambito2==6) %>% summarise(sum(fac)))
tamano <- data.frame(Pequeña = c(peq1,peq2,peq3,peq4),
                     Mediana = c(med1,med2,med3,med4),
                     Grande = c(gra1, gra2, gra3, gra4),
                     row.names = c('Trimestre I','Trimestre II', 'Trimestre III','Trimestre IV'))
tamano <- tamano %>% mutate(tamano, Total = Pequeña + Mediana + Grande)
knitr::kable(tamano, booktabs = TRUE, format = 'latex', longtable = F, 
             caption = "Absoluto de empleados por tamaño de empresa"
)%>%
  kable_styling(latex_options = "hold_position", "center")
tit <- data.frame(Pequeña = c(peq1/(peq1+med1+gra1),peq2/(peq2+med2+gra2),peq3/(peq3+med3+gra3),peq4/(peq4+med4+gra4))*100,
                     Mediana = c(med1/(peq1+med1+gra1),med2/(peq2+med2+gra2),med3/(peq3+med3+gra3),med4/(peq4+med4+gra4))*100,
                     Grande = c(gra1/(peq1+med1+gra1), gra2/(peq2+med2+gra2), gra3/(peq3+med3+gra3), gra4/(peq4+med4+gra4))*100,
                     row.names = c('Trimestre I','Trimestre II', 'Trimestre III','Trimestre IV'))
knitr::kable(tit, booktabs = TRUE, format = 'latex', longtable = F, 
             caption = "Relativo de empleados por tamaño de empresa"
)%>%
  kable_styling(latex_options = "hold_position", "center")
Pequeña <- c(peq1,peq2,peq3,peq4)
Mediana <- c(med1,med2,med3,med4)
Grande <- c(gra1,gra2,gra3,gra4)
tamano2 <- data.frame(Trimestre = c('Trimestre I','Trimestre II', 'Trimestre III','Trimestre IV'),
                      Tamaño = c(Pequeña,Mediana,Grande),
                      nombre = c(rep('Pequeña',4), rep('Mediana', 4), rep('Grande',4)))
pacman::p_load(scales)

ggplot(tamano2,aes(x = nombre, y =Tamaño, fill = Trimestre)) +
geom_bar(stat = "identity", position = "dodge" ) +
  labs(title = "Número de empleados por tamaño de empresas (2019)", x="Tamaño de Empresa",y='Número de Empleados') + theme_bw() +  theme(text=element_text(size=12,  family="serif")) + scale_y_continuous(labels = comma)
```

### (g) 
**Calcule qué fracción de los trabajadores está buscando otro empleo.**

Resulta interesante conocer estas cifras, ya que el mercado laboral experimenta "presiones" que provienen de aquellos individuos en situación de búsqueda de trabajo. En este rubro no sólo entran las personas desocupadas, sino también las que ya tienen trabajo pero por alguna razón quieren encontrar otro.

```{r fig.cap="Búsqueda de otro Empleo, 2019", fig.height = 2, fig.width = 4}
busq1 <- as.numeric(filter(t119, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98, tpg_p8a == 1) %>% summarise(sum(fac)))

busq2 <- as.numeric(filter(t219, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  tpg_p8a == 1) %>% summarise(sum(fac)))

busq3 <- as.numeric(filter(t319, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  tpg_p8a == 1) %>% summarise(sum(fac)))

busq4 <- as.numeric(filter(t419, r_def == 0, c_res == 1 | c_res == 3, eda >= 15 & eda <= 98,  tpg_p8a == 1) %>% summarise(sum(fac)))

busq <- data.frame(Búsqueda = c(busq1, busq2, busq3, busq4), 
                    row.names = c('Trimestre I','Trimestre II','Trimestre III','Trimestre IV'))
knitr::kable(busq, booktabs = TRUE, format = 'latex', longtable = F, caption = "Empleados en búsqueda de otro empleo 2019"
)%>%
  kable_styling(latex_options = "hold_position", "center")

busq_ <- data.frame(Trimestre = c(' I',' II',' III',' IV'),
                     busqu = c(busq1, busq2, busq3, busq4))

g3 <- ggplot(busq_, aes(Trimestre,busqu)) + geom_bar(stat = "identity", fill = "blue", color = "black", width = 0.6) + theme_bw() + labs(title = "Número de empleados en búsqueda de otro trabajo 2019", xlab = " Trimestre ", y="Porcentaje") +  theme(text=element_text(size=8,  family="serif")) +  scale_y_continuous(label = comma)
g3


```
\clearpage

### (h)
**Grafique la relación entre el ingreso promedio y la edad de los trabajadores.**

En las siguientes figuras se muestra la relación que existe entre la edad y el ingreso para los cuatro trimestres del 2019. Es de recalcar que, a grandes rasgos, se tiene mayor ingreso en una edad adulta, antes de envejecer. Esto resulta lógico, pues se percibe mayor ingreso en la etapa más productiva de la vida. Resulta interesante, también, que en los cuatro trimestres el promedio es bastante alto para algunas edades rondando los 85 años.


```{r echo = FALSE, fig.cap = "Relación entre Edad e Ingreso", fig.pos='H', fig.height=5}


ingprom1 <- t119 %>% group_by(eda) %>% filter(clase1 == 1, eda >= 15) %>% summarise(avg_ing1= mean(ing_x_hrs))
ingprom2 <- t219 %>% group_by(eda) %>% filter(clase1 == 1, eda >= 15) %>% summarise(avg_ing2= mean(ing_x_hrs))
ingprom3 <- t319 %>% group_by(eda) %>% filter(clase1 == 1, eda >= 15) %>% summarise(avg_ing3= mean(ing_x_hrs))
ingprom4 <- t419 %>% group_by(eda) %>% filter(clase1 == 1, eda >= 15) %>% summarise(avg_ing4= mean(ing_x_hrs))

ingprom <- data.frame(c(ingprom1, ingprom2, ingprom3, ingprom4))
ingprom <- ingprom[,-c(3,5,7)]



p1 <- ggplot(ingprom, aes(eda,avg_ing1)) + geom_point(colour="brown", size=1) + labs(title = "Edad vs Ingreso 1T 2019", x="Edad",y="Ingreso por hora") + theme_bw() +  theme(text=element_text(size=12,  family="serif")) + geom_smooth(method = 'lm')

p2 <- ggplot(ingprom, aes(eda,avg_ing2)) + geom_point(colour="blue", size=1) + labs(title = "Edad vs Ingreso 2T 2019", x="Edad",y="Ingreso por hora") + theme_bw() +  theme(text=element_text(size=12,  family="serif")) + geom_smooth(method = 'lm', colour = "brown")

p3 <- ggplot(ingprom, aes(eda,avg_ing3)) + geom_point(colour="blue", size=1) + labs(title = "Edad vs Ingreso 3T 2019", x="Edad",y="Ingreso por hora") + theme_bw() +  theme(text=element_text(size=12,  family="serif")) + geom_smooth(method = 'lm', colour = "brown")

p4 <- ggplot(ingprom, aes(eda,avg_ing4)) + geom_point(colour="brown", size=1) + labs(title = "Edad vs Ingreso 4T 2019", x="Edad",y="Ingreso por hora") + theme_bw() +  theme(text=element_text(size=12,  family="serif")) + geom_smooth(method = 'lm')

plot_grid(p1,p2,p3,p4, ncol= 2 , nrow = 2)

```

Además, se agregó el comando *geom_smooth(method = 'lm') (lm: least square method)*, con el objetivo de de observar, en una primera instancia, la tendencia general de esta relación. Como puede verse, en todos los periodos contemplados la tendencia es a la baja: a mayor edad se percibe menor salario (bajo este método). Por otra parte, los dos trimestres de en medio son los que tienen más marcada esta tendencia hacia la baja.

